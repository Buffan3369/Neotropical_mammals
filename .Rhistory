theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf() +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#d95f02", "#e6ab02")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf() +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fde0dd")) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
?aes
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fde0dd", alpha = 1)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fde0dd", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
length(which(occdf$loc == "T"))
1759-131
ct <- occdf %>%
group_by(genus, loc) %>%
count(genus)
View(ct)
length(which(ct$loc == 'T'))
length(which(ct$loc == 'E'))
ct <- occdf %>%
group_by(accepted_name, loc) %>%
count(accepted_name)
length(which(ct$loc == 'T'))
length(which(ct$loc == 'E'))
ct <- occdf %>%
group_by(accepted_name, diet) %>%
count(accepted_name)
length(which(ct$diet == "carnivore"))
length(which(ct$diet == "herbivore"))
length(which(ct$diet == "omnivore"))
length(which(ct$diet == "insectivore"))
ct <- occdf %>%
group_by(genus, diet) %>%
count(genus)
length(which(ct$diet == "carnivore"))
length(which(ct$diet == "herbivore"))
length(which(ct$diet == "omnivore"))
length(which(ct$diet == "insectivore"))
68+1212+270+209
length(unique(occdf$collection_no))
ct <- occdf %>%
group_by(collection_no, loc) %>%
count(loc)
View(ct)
length(unique(which(ct$loc == 'E')))
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
p <- world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 15, width = 10)
?geom_point
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 3)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 2)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 1)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
rm(list = ls())
library(sf)
library(spData)
library(ggplot2)
library(tidyverse)
data("world")
occdf <- readRDS("./data_2023/SPECIES_LISTS/5-Fully_cleaned_EOT_SA_Mammals_SALMA_kept_Tropics_Diet.RDS")
p <- world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 1)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 15, width = 10)
p <- world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 0.5)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 15, width = 10)
p <- world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc, size = 0.05)) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 15, width = 10)
world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc), size = 2) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
p <- world %>%
filter(continent == "South America") %>%
ggplot() +
geom_sf(aes(fill = "#fff7f3", alpha = 0.2)) +
geom_point(data = occdf, aes(x = lng, y = lat, colour = loc), size = 2) +
scale_color_manual(values = c("#5ab4ac", "#8c510a")) +
theme(axis.line=element_blank(),
axis.text.x=element_blank(),
axis.text.y=element_blank(),
axis.ticks=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background = element_blank(),
legend.position="none")
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 15, width = 10)
ggsave("./figures/Fig_S2_occurrences_map.png", plot = p, height = 10, width = 7.5)
tbl <- readRDS("./data_2023/SPECIES_LISTS/5-Fully_cleaned_EOT_SA_Mammals_SALMA_kept_Tropics_Diet.RDS")
# Non-Na orders
full_odr <- unique(tbl$order)[!is.na(unique(tbl$order))]
# Assess number of occ, singleton and proportion of singleton per order
final_df <- data.frame(order = full_odr,
n_occ = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(nrow(tmp))}),
n_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$genus)))}),
n_singl_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
gen_count <- tmp %>% count(genus)
S <- which(gen_count$n == 1)
return(length(S))
}),
n_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$accepted_name)))}),
n_singl_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
sp_count <- tmp %>% count(accepted_name)
S <- which(sp_count$n == 1)
return(length(S))
}))
library(tidyverse)
tbl <- readRDS("./data_2023/SPECIES_LISTS/5-Fully_cleaned_EOT_SA_Mammals_SALMA_kept_Tropics_Diet.RDS")
# Non-Na orders
full_odr <- unique(tbl$order)[!is.na(unique(tbl$order))]
# Assess number of occ, singleton and proportion of singleton per order
final_df <- data.frame(order = full_odr,
n_occ = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(nrow(tmp))}),
n_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$genus)))}),
n_singl_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
gen_count <- tmp %>% count(genus)
S <- which(gen_count$n == 1)
return(length(S))
}),
n_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$accepted_name)))}),
n_singl_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
sp_count <- tmp %>% count(accepted_name)
S <- which(sp_count$n == 1)
return(length(S))
}))
View(final_df)
ttl_count_gen <- tbl %>% count(genus)
ttl_count_sp <- tbl %>% count(accepted_name)
final_df <- final_df %>% add_row(order = "total", n_occ = nrow(tbl),
n_gen = nrow(ttl_count_gen), n_singl_gen = length(which(ttl_count_gen$n == 1)),
n_sp = nrow(ttl_count_sp), n_singl_sp = length(which(ttl_count_sp$n == 1)))
final_df <- data.frame(order = full_odr,
n_occ = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(nrow(tmp))}),
n_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$genus)))}),
n_singl_gen = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
gen_count <- tmp %>% count(genus)
S <- which(gen_count$n == 1)
return(length(S))
}),
n_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
return(length(unique(tmp$accepted_name)))}),
n_singl_sp = sapply(X = full_odr,
FUN = function(x){
tmp <- tbl %>% filter(order == x)
sp_count <- tmp %>% count(accepted_name)
S <- which(sp_count$n == 1)
return(length(S))
}))
# Add "total" row
ttl_count_gen <- tbl %>% count(genus)
ttl_count_sp <- tbl %>% count(accepted_name)
final_df <- final_df %>% add_row(order = "Total", n_occ = nrow(tbl),
n_gen = nrow(ttl_count_gen), n_singl_gen = length(which(ttl_count_gen$n == 1)),
n_sp = nrow(ttl_count_sp), n_singl_sp = length(which(ttl_count_sp$n == 1)))
View(final_df)
<,add_column
?add_column
final_df <- final_df %>%
add_column(prop_singl_gen = prop_singl_gen, .after = n_singl_gen) %>%
add_column(prop_singl_sp = prop_singl_sp, .after = n_singl_sp)
# Add "propotion of singleton" column
prop_singl_gen <- sapply(X = 1:nrow(final_df),
FUN = function(x){
occ <- final_df$n_gen[x]
singl <- final_df$n_singl_gen[x]
prop <- (singl / occ)
return(round(prop, digits = 2))
})
prop_singl_sp <- sapply(X = 1:nrow(final_df),
FUN = function(x){
occ <- final_df$n_sp[x]
singl <- final_df$n_singl_sp[x]
prop <- (singl / occ)
return(round(prop, digits = 2))
})
final_df <- final_df %>%
add_column(prop_singl_gen = prop_singl_gen, .after = n_singl_gen) %>%
add_column(prop_singl_sp = prop_singl_sp, .after = n_singl_sp)
final_df <- final_df %>%
add_column(prop_singl_gen = prop_singl_gen, .after = "n_singl_gen") %>%
add_column(prop_singl_sp = prop_singl_sp, .after = "n_singl_sp")
# save
write.csv(final_df, "./data_2023/recap_tbl_EOT.csv", row.names = FALSE)
################################################################################
# Name: 3-SALMA_smoothing.R
# Author: Lucas Buffan
# Date: 2023-12-13
# Aim: 'Smooth' SALMAs => match boundaries of the occurrences
#   associated to a SALMA with those of their corresponding sub-epoch
################################################################################
library(readxl)
library(tidyverse)
library(palaeoverse)
## Load data -------------------------------------------------------------------
SubEpochs <- read_xlsx("./data_2023/time_bins/EarlyMidLate_epochs.xlsx")
SubEpochs$bin <- 1:nrow(SubEpochs) #add 'bin' columns for `bin_time`
SALMA_EOT <- read_xlsx("./data_2023/time_bins/SALMA_EOT.xlsx")
species_list <- readRDS("./data_2023/SPECIES_LISTS/5-Fully_cleaned_EOT_SA_Mammals_SALMA_kept_Tropics_Diet.RDS")
## Bin SALMAs with the Sub-Epochs they most overlap with -----------------------
binning <- palaeoverse::bin_time(occdf = data.frame(max_ma = SALMA_EOT$max_ma,
min_ma = SALMA_EOT$min_ma),
bins = SubEpochs,
method = "majority")
SALMA_EOT_Sub_epoch <- sapply(X = binning$bin_assignment,
FUN = function(x){
return(SubEpochs$interval_name[which(SubEpochs$bin == x)])
})
SALMA_EOT <- SALMA_EOT %>% add_column(Sub_Epoch = SALMA_EOT_Sub_epoch,
.after = "epoch")
## Subset occ associated to a SALMA --------------------------------------------
#(Re)create Early/Late stage column
split_stage <- function(stage, early=TRUE){
hyphen_split <- strsplit(stage, split = "-")[[1]]
if(early == TRUE){
return(hyphen_split[1])
}
else{
if(length(hyphen_split) > 1){
return(hyphen_split[2])
}
else{
return(NA)
}
}
}
species_list <- species_list %>% add_column(Early_stage = sapply(X = species_list$stage,
FUN = split_stage),
Late_stage = sapply(X = species_list$stage,
FUN = split_stage,
early = FALSE),
.after = "stage")
#Split SALMA-associated occurrences
spl_EOT <- species_list %>% filter(Early_stage %in% SALMA_EOT$interval_name)
cat("A total of", nrow(spl_EOT), "occurrences (representing",
round( (nrow(spl_EOT) / nrow(species_list)), digits = 2 )*100,
"% of the total) are associated to a SALMA.\n")
get_ref <- function(stage, Which=c("min", "max")){
#get the ref age
hyp_split <- strsplit(stage, split = "-")[[1]]
if(length(hyp_split) > 1){
corr_early <- SALMA_EOT$Sub_Epoch[which(SALMA_EOT$interval_name == hyp_split[1])]
corr_late <- SALMA_EOT$Sub_Epoch[which(SALMA_EOT$interval_name == hyp_split[2])]
ref_max <- SubEpochs$max_ma[which(SubEpochs$interval_name == corr_early)]
ref_min <- SubEpochs$min_ma[which(SubEpochs$interval_name == corr_late)]
}
else{
corr <- SALMA_EOT$Sub_Epoch[which(SALMA_EOT$interval_name == stage)]
ref_max <- SubEpochs$max_ma[which(SubEpochs$interval_name == corr)]
ref_min <- SubEpochs$min_ma[which(SubEpochs$interval_name == corr)]
}
#return
if(Which == "min"){
return(ref_min)
}
else{
return(ref_max)
}
}
spl_EOT$min_ma <- sapply(X = spl_EOT$stage, FUN = get_ref, Which = "min")
spl_EOT$max_ma <- sapply(X = spl_EOT$stage, FUN = get_ref, Which = "max")
## Merge the two datasets (SALMA/not_SALMA) and save ---------------------------
spl_not_EOT <- species_list %>% filter(Early_stage %in% SALMA_EOT$interval_name == FALSE)
spl <- rbind.data.frame(spl_not_EOT, spl_EOT)
spl <- data.frame(spl)
spl <- spl %>%
select(-c(Early_stage, Late_stage)) %>%
arrange(order, family, genus, accepted_name, cc)
spl$min_ma <- as.numeric(spl$min_ma) #for some reason, the "min_ma" column turned into a list...
spl$min_ma[which(spl$genus == "tegotherium")] <- 47.8 #unbinned otherwise
saveRDS(spl, "./data_2023/SPECIES_LISTS/6-Fully_cleaned_EOT_SA_Mammals_SALMA_smoothed_Tropics_Diet.RDS")
################################################################################
# Name: 0-SALMA_scale_plot.R
# Author: Lucas Buffan
# Date: 2024-01-10
# Aim: Quick script for SALMA plotting
################################################################################
library(ggplot2)
library(dplyr)
library(deeptime)
## Load timescales -------------------------------------------------------------
SubEpochs <- read_xlsx("./data_2023/time_bins/EarlyMidLate_epochs.xlsx")
SubEpochs <- SubEpochs %>%
rename(name="interval_name", min_age="min_ma", max_age="max_ma")
SALMA_EOT <- read_xlsx("./data_2023/time_bins/SALMA_EOT.xlsx")
SALMA_EOT <- SALMA_EOT %>%
rename(name="interval_name", min_age="min_ma", max_age="max_ma")
## Plot and save ---------------------------------------------------------------
p <- ggplot() +
geom_point(aes(y = runif(1000, 23.03, 56)), x = runif(1000, 0, 1)) +
scale_y_reverse(breaks = c(23.03, 27.82, 33.9, 37.71, 47.8, 56), limits = c(23, 56.03)) +
coord_geo(dat = list("epochs", SubEpochs, SALMA_EOT),
pos = as.list(rep("left", 3)),
rot = list(90, 90, 0),
size = list(10, 8, 4),
abbrv = list(FALSE, TRUE, FALSE)) +
theme_classic()
ggsave("./figures/methods_figure/SALMA_scale.pdf", plot = p, width = 10, height = 30)

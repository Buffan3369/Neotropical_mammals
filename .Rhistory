# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
# for(odr in keys(tax_dict)){
#   tmp_tste_odr <- tste_ttl %>%
#     filter(tax %in% values(tax_dict[odr])) %>%
#     select(!c("tax"))
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS_5M/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
# }
# same for ecomorphotypes
for(dt in c("herbivore", "carnivore", "omnivore", "insectivore")){
tmp_tste_diet <- tste_ttl %>%
filter(diet == dt) %>%
select(!c("tax"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
}
}
}
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = unlist(ref$diet))
# Loop across the four outputs
for(salma in c("SALMA_kept", "SALMA_smoothed")){
for(lvl in c("genus_level", "species_level")){
# choose reference
if(lvl == "species_level"){
ref <- sp_ref
}
else{
ref <- gen_ref
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = unlist(ref$diet))
# for(odr in keys(tax_dict)){
#   tmp_tste_odr <- tste_ttl %>%
#     filter(tax %in% values(tax_dict[odr])) %>%
#     select(!c("tax"))
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS_5M/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
# }
# same for ecomorphotypes
for(dt in c("herbivore", "carnivore", "omnivore", "insectivore")){
tmp_tste_diet <- tste_ttl %>%
filter(diet == dt) %>%
select(!c("tax"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
}
}
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = unlist(ref$diet))
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ef$diet)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
class(tste_ttl$diet)
# Loop across the four outputs
for(salma in c("SALMA_kept", "SALMA_smoothed")){
for(lvl in c("genus_level", "species_level")){
# choose reference
if(lvl == "species_level"){
ref <- sp_ref
}
else{
ref <- gen_ref
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
tste_ttl$diet <- unlist(tste_ttl$diet)
# for(odr in keys(tax_dict)){
#   tmp_tste_odr <- tste_ttl %>%
#     filter(tax %in% values(tax_dict[odr])) %>%
#     select(!c("tax"))
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS_5M/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
# }
# same for ecomorphotypes
for(dt in c("herbivore", "carnivore", "omnivore", "insectivore")){
tmp_tste_diet <- tste_ttl %>%
filter(diet == dt) %>%
select(!c("tax"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
}
}
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
tste_ttl$diet <- unlist(tste_ttl$diet)
View(tste_ttl)
sp_ref <- read.table("./data_2023/PyRate/EXTENDED/SALMA_kept/species_level/1-Full/Full_EOT_sp_occ_SALMA_kept_TaxonList.txt", header = TRUE)
sp_ref <- sp_ref %>%
mutate(order = sapply(X = sp_ref$Species,
FUN = function(x){
unique(occdf$order[which(occdf$accepted_name == x)])
}),
diet = sapply(X = sp_ref$Species,
FUN = function(x){
occdf$diet[which(occdf$accepted_name == x)][1]
})
)
gen_ref <- read.table("./data_2023/PyRate/EXTENDED/SALMA_kept/genus_level/1-Full/Full_EOT_gen_occ_SALMA_kept_TaxonList.txt", header = TRUE)
gen_ref <- gen_ref %>%
mutate(order = sapply(X = gen_ref$Species,
FUN = function(x){
unique(occdf$order[which(occdf$genus == x)])
}),
diet = sapply(X = gen_ref$Species,
FUN = function(x){
occdf$diet[which(occdf$genus == x)][1]
})
)
# Loop across the four outputs
for(salma in c("SALMA_kept", "SALMA_smoothed")){
for(lvl in c("genus_level", "species_level")){
# choose reference
if(lvl == "species_level"){
ref <- sp_ref
}
else{
ref <- gen_ref
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
tste_ttl$diet <- unlist(tste_ttl$diet)
# for(odr in keys(tax_dict)){
#   tmp_tste_odr <- tste_ttl %>%
#     filter(tax %in% values(tax_dict[odr])) %>%
#     select(!c("tax"))
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
#   write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS_5M/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
#                     x = tmp_tste_odr)
# }
# same for ecomorphotypes
for(dt in c("herbivore", "carnivore", "omnivore", "insectivore")){
tmp_tste_diet <- tste_ttl %>%
filter(diet == dt) %>%
select(!c("tax"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
}
}
}
# Loop across the four outputs
for(salma in c("SALMA_kept", "SALMA_smoothed")){
for(lvl in c("genus_level", "species_level")){
# choose reference
if(lvl == "species_level"){
ref <- sp_ref
}
else{
ref <- gen_ref
}
# open corresponding TsTe file
tste_dir <- paste0("./results_EXTENDED/", salma, "/", lvl, "/1-Full/MH_sampler/LTT/")
tste <- list.files(path = tste_dir, pattern = "_se_est.txt")[1]
tste_ttl <- read.table(paste(tste_dir, tste, sep = "/"),
header = TRUE)
tste_ttl <- tste_ttl %>% add_column(tax = ref$order, genus = ref$Species, diet = ref$diet)
for(odr in keys(tax_dict)){
tmp_tste_odr <- tste_ttl %>%
filter(tax %in% values(tax_dict[odr])) %>%
select(!c("tax", "genus", "diet"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_odr)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/6-Order_level/", odr, "/BDCS_5M/TsTe_", odr, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_odr)
}
# same for ecomorphotypes
for(dt in c("herbivore", "carnivore", "omnivore", "insectivore")){
tmp_tste_diet <- tste_ttl %>%
filter(diet == dt) %>%
select(!c("tax", "genus", "diet"))
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
write.table.lucas(file = paste0("./results_EXTENDED/", salma, "/", lvl, "/5-Ecomorphotype/TsTe_", dt, "_", salma, "_", lvl, ".txt"),
x = tmp_tste_diet)
}
}
}
## Generate plotting dataframe -------------------------------------------------
dir <- "./results_EXTENDED/SALMA_smoothed/genus_level/5-Ecomorphotype/"
plt_dataframe <- data.frame(Age = NA,
Diversity = NA,
min_Diversity = NA,
max_Diversity = NA,
Diet = NA)
ecm="herivore"
## Generate plotting dataframe -------------------------------------------------
dir <- "./results_EXTENDED/SALMA_smoothed/genus_level/5-Ecomorphotype/"
plt_dataframe <- data.frame(Age = NA,
Diversity = NA,
min_Diversity = NA,
max_Diversity = NA,
Diet = NA)
ltt_tbl <- read.table(paste0(dir, "/TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"))
ltt_tbl <- read.table(paste0(dir, "TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"))
## Generate plotting dataframe -------------------------------------------------
dir <- "./results_EXTENDED/SALMA_smoothed/genus_level/5-Ecomorphotype"
## Generate plotting dataframe -------------------------------------------------
dir <- "./results_EXTENDED/SALMA_smoothed/genus_level/5-Ecomorphotype"
ltt_tbl <- read.table(paste0(dir, "/TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"))
ecm="herbivore"
ltt_tbl <- read.table(paste0(dir, "/TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"))
View(ltt_tbl)
plt_dataframe <- data.frame(Age = NA,
Diversity = NA,
min_Diversity = NA,
max_Diversity = NA,
Diet = NA)
for(ecm in c("carnivore", "herbivore", "omnivore", "insectivore")){
ltt_tbl <- read.table(paste0(dir, "/TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"), header = TRUE)
ltt_tbl <- ltt_tbl %>%
rename(Age = "time", diversity = "Diversity", m_div = "min_Diversity", M_div = "max_Diversity") %>%
filter(Age > 24 & Age < 52) %>%
add_column(Diet = ecm)
plt_dataframe <- rbind.data.frame(plt_dataframe, ltt_tbl)
}
for(ecm in c("carnivore", "herbivore", "omnivore", "insectivore")){
ltt_tbl <- read.table(paste0(dir, "/TsTe_", ecm, "_SALMA_smoothed_genus_level_ltt.txt"), header = TRUE)
ltt_tbl <- ltt_tbl %>%
rename(Age = "time", Diversity = "diversity", min_Diversity = "m_div", max_Diversity = "M_div") %>%
filter(Age > 24 & Age < 52) %>%
add_column(Diet = ecm)
plt_dataframe <- rbind.data.frame(plt_dataframe, ltt_tbl)
}
plt_dataframe <- plt_dataframe[-c(1),] #remove initialising row
View(plt_dataframe)
## Actual plot -----------------------------------------------------------------
# First geoscale
gsc1 <- deeptime::epochs
gsc1 <- gsc1 %>% filter(min_age < 56)
# Set second geoscale
gsc2 <- read_xlsx("./data_2023/time_bins/EarlyMidLate_epochs.xlsx")
## Source helper functions from CorsaiR and additional facilities --------------
source("~/Documents/GitHub/CorsaiR/R/1-extract_param_from_PyRate_outputs.R")
source("~/Documents/GitHub/CorsaiR/R/2-plotting_facilities.R")
library("readxl")
library("hash")
library("tidyverse")
library("ggpubr")
## Actual plot -----------------------------------------------------------------
# First geoscale
gsc1 <- deeptime::epochs
gsc1 <- gsc1 %>% filter(min_age < 56)
# Set second geoscale
gsc2 <- read_xlsx("./data_2023/time_bins/EarlyMidLate_epochs.xlsx")
gsc2 <- gsc2 %>% rename(min_age = "min_ma", max_age = "max_ma", name = "interval_name")
# Plot
fig3 <- ggplot(data = plt_dataframe, aes(x = Age, y = Diversity, colour = Diet)) +
# Aesthetics
scale_x_reverse(breaks = seq(25, 50, 5), expand = c(0, 0)) +
scale_y_continuous(breaks = seq(0,(round(max(plt_dataframe$Diversity), -1) + 10),20),
limits = c(0,(round(max(plt_dataframe$Diversity), -1) + 20)),
expand = c(0, 0)) +
labs(x = "Time (Ma)", y = "Diversity (nb. lineages)") +
# Time interval bands
annotate(geom = "rect", xmin = 47.8, xmax = Inf, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = 33.9, xmax = 37.71, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = -Inf, xmax = 27.8, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
# Climate optima bands
annotate(geom = "rect", xmin = 51, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "bisque") +
annotate(geom = "rect", xmin = 41, xmax = 41.5, ymin = -Inf, ymax = Inf, fill = "bisque") +
# Climate optima labels
geom_text(aes(x = 51.45, y = 77, label = "EECO"), angle = 90, colour = "bisque4") +
geom_text(aes(x = 41.25, y = 77, label = "MECO"), angle = 90, colour = "bisque4") +
# Lines
geom_line(aes(x = Age, y = Diversity, color = Diet), linewidth = 1) +
# Line colours
scale_colour_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# Ribbons
geom_ribbon(aes(x = Age, ymin = min_Diversity, ymax = max_Diversity, fill = Diet),
alpha = 0.5, colour = NA) +
# Ribbon colours
scale_fill_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# EOT line
geom_vline(xintercept = 33.9, linetype="dashed", color = "red", linewidth = 0.8) +
annotate(geom = "text", x = 32.7, y = 87, label = "EOT", size = 7, colour = "red") +
# Labels
annotate(geom = "segment", x = 46, xend = 47.5, y = 85, yend = 85, colour = "#de2d26", linewidth = 1.5) +
annotate(geom = "text", x = 45.5, y = 85, label = "Carnivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 46, xend = 47.5, y = 80, yend = 80, colour = "#31a354", linewidth = 1.5) +
annotate(geom = "text", x = 45.5, y = 80, label = "Herbivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 46, xend = 47.5, y = 75, yend = 75, colour = "#756bb1", linewidth = 1.5) +
annotate(geom = "text", x = 45.5, y = 75, label = "Insectivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 46, xend = 47.5, y = 70, yend = 70, colour = "#2b8cbe", linewidth = 1.5) +
annotate(geom = "text", x = 45.5, y = 70, label = "Omnivorous", hjust = 0, size = 5) +
# Theme
theme(axis.title.x = element_text(size = 18),
axis.title.y = element_text(size = 18),
axis.text = element_text(size = 15),
panel.background = element_blank(),
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.25)) +
# GTS
coord_geo(pos = list("bottom", "bottom"),
dat = list(gsc2, gsc1),
abbrv = list(T, F),
center_end_labels = TRUE,
height = unit(1.5, "line"),
size = "auto",
clip = "off")
fig
fig3
# Plot
fig3 <- ggplot(data = plt_dataframe, aes(x = Age, y = Diversity, colour = Diet)) +
# Aesthetics
scale_x_reverse(breaks = seq(25, 50, 5), expand = c(0, 0)) +
scale_y_continuous(breaks = seq(0,(round(max(plt_dataframe$Diversity), -1) + 10),20),
limits = c(0,(round(max(plt_dataframe$Diversity), -1) + 20)),
expand = c(0, 0)) +
labs(x = "Time (Ma)", y = "Diversity (nb. lineages)") +
# Time interval bands
annotate(geom = "rect", xmin = 47.8, xmax = Inf, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = 33.9, xmax = 37.71, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = -Inf, xmax = 27.8, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
# Climate optima bands
annotate(geom = "rect", xmin = 51, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "bisque") +
annotate(geom = "rect", xmin = 41, xmax = 41.5, ymin = -Inf, ymax = Inf, fill = "bisque") +
# Climate optima labels
geom_text(aes(x = 51.45, y = 77, label = "EECO"), angle = 90, colour = "bisque4") +
geom_text(aes(x = 41.25, y = 77, label = "MECO"), angle = 90, colour = "bisque4") +
# Lines
geom_line(aes(x = Age, y = Diversity, color = Diet), linewidth = 1) +
# Line colours
scale_colour_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# Ribbons
geom_ribbon(aes(x = Age, ymin = min_Diversity, ymax = max_Diversity, fill = Diet),
alpha = 0.5, colour = NA) +
# Ribbon colours
scale_fill_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# EOT line
geom_vline(xintercept = 33.9, linetype="dashed", color = "red", linewidth = 0.8) +
annotate(geom = "text", x = 32.7, y = 87, label = "EOT", size = 7, colour = "red") +
# Labels
annotate(geom = "segment", x = 50.5, xend = 49, y = 85, yend = 85, colour = "#de2d26", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 85, label = "Carnivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 80, yend = 80, colour = "#31a354", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 80, label = "Herbivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 75, yend = 75, colour = "#756bb1", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 75, label = "Insectivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 70, yend = 70, colour = "#2b8cbe", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 70, label = "Omnivorous", hjust = 0, size = 5) +
# Theme
theme(axis.title.x = element_text(size = 18),
axis.title.y = element_text(size = 18),
axis.text = element_text(size = 15),
panel.background = element_blank(),
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.25)) +
# GTS
coord_geo(pos = list("bottom", "bottom"),
dat = list(gsc2_bis, gsc1_bis),
abbrv = list(T, F),
center_end_labels = TRUE,
height = unit(1.5, "line"),
size = "auto",
clip = "off")
# Weird modifications for plotting
gsc1_bis <- gsc1
gsc1_bis$max_age[nrow(gsc1_bis)] <- 52
gsc1_bis$min_age[1] <- 24
gsc2_bis <- gsc2 %>% filter(max_age <= 56)
gsc2_bis$max_age[nrow(gsc2_bis)] <- 52
gsc2_bis$min_age[1] <- 24
# Plot
fig3 <- ggplot(data = plt_dataframe, aes(x = Age, y = Diversity, colour = Diet)) +
# Aesthetics
scale_x_reverse(breaks = seq(25, 50, 5), expand = c(0, 0)) +
scale_y_continuous(breaks = seq(0,(round(max(plt_dataframe$Diversity), -1) + 10),20),
limits = c(0,(round(max(plt_dataframe$Diversity), -1) + 20)),
expand = c(0, 0)) +
labs(x = "Time (Ma)", y = "Diversity (nb. lineages)") +
# Time interval bands
annotate(geom = "rect", xmin = 47.8, xmax = Inf, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = 33.9, xmax = 37.71, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = -Inf, xmax = 27.8, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
# Climate optima bands
annotate(geom = "rect", xmin = 51, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "bisque") +
annotate(geom = "rect", xmin = 41, xmax = 41.5, ymin = -Inf, ymax = Inf, fill = "bisque") +
# Climate optima labels
geom_text(aes(x = 51.45, y = 77, label = "EECO"), angle = 90, colour = "bisque4") +
geom_text(aes(x = 41.25, y = 77, label = "MECO"), angle = 90, colour = "bisque4") +
# Lines
geom_line(aes(x = Age, y = Diversity, color = Diet), linewidth = 1) +
# Line colours
scale_colour_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# Ribbons
geom_ribbon(aes(x = Age, ymin = min_Diversity, ymax = max_Diversity, fill = Diet),
alpha = 0.5, colour = NA) +
# Ribbon colours
scale_fill_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# EOT line
geom_vline(xintercept = 33.9, linetype="dashed", color = "red", linewidth = 0.8) +
annotate(geom = "text", x = 32.7, y = 87, label = "EOT", size = 7, colour = "red") +
# Labels
annotate(geom = "segment", x = 50.5, xend = 49, y = 85, yend = 85, colour = "#de2d26", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 85, label = "Carnivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 80, yend = 80, colour = "#31a354", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 80, label = "Herbivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 75, yend = 75, colour = "#756bb1", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 75, label = "Insectivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 70, yend = 70, colour = "#2b8cbe", linewidth = 1.5) +
annotate(geom = "text", x = 47.5, y = 70, label = "Omnivorous", hjust = 0, size = 5) +
# Theme
theme(axis.title.x = element_text(size = 18),
axis.title.y = element_text(size = 18),
axis.text = element_text(size = 15),
panel.background = element_blank(),
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.25)) +
# GTS
coord_geo(pos = list("bottom", "bottom"),
dat = list(gsc2_bis, gsc1_bis),
abbrv = list(T, F),
center_end_labels = TRUE,
height = unit(1.5, "line"),
size = "auto",
clip = "off")
fig3
# Plot
fig3 <- ggplot(data = plt_dataframe, aes(x = Age, y = Diversity, colour = Diet)) +
# Aesthetics
scale_x_reverse(breaks = seq(25, 50, 5), expand = c(0, 0)) +
scale_y_continuous(breaks = seq(0,(round(max(plt_dataframe$Diversity), -1) + 10),20),
limits = c(0,(round(max(plt_dataframe$Diversity), -1) + 20)),
expand = c(0, 0)) +
labs(x = "Time (Ma)", y = "Diversity (nb. lineages)") +
# Time interval bands
annotate(geom = "rect", xmin = 47.8, xmax = Inf, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = 33.9, xmax = 37.71, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
annotate(geom = "rect", xmin = -Inf, xmax = 27.8, fill = "grey10", ymin = -Inf, ymax = Inf, alpha = 0.1, linewidth = 0) +
# Climate optima bands
annotate(geom = "rect", xmin = 51, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "bisque") +
annotate(geom = "rect", xmin = 41, xmax = 41.5, ymin = -Inf, ymax = Inf, fill = "bisque") +
# Climate optima labels
geom_text(aes(x = 51.45, y = 77, label = "EECO"), angle = 90, colour = "bisque4") +
geom_text(aes(x = 41.25, y = 77, label = "MECO"), angle = 90, colour = "bisque4") +
# Lines
geom_line(aes(x = Age, y = Diversity, color = Diet), linewidth = 1) +
# Line colours
scale_colour_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# Ribbons
geom_ribbon(aes(x = Age, ymin = min_Diversity, ymax = max_Diversity, fill = Diet),
alpha = 0.5, colour = NA) +
# Ribbon colours
scale_fill_manual(values = c("#de2d26", "#31a354", "#756bb1", "#2b8cbe")) +
# EOT line
geom_vline(xintercept = 33.9, linetype="dashed", color = "red", linewidth = 0.8) +
annotate(geom = "text", x = 32.7, y = 87, label = "EOT", size = 7, colour = "red") +
# Labels
annotate(geom = "segment", x = 50.5, xend = 49, y = 85, yend = 85, colour = "#de2d26", linewidth = 1.5) +
annotate(geom = "text", x = 48, y = 85, label = "Carnivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 80, yend = 80, colour = "#31a354", linewidth = 1.5) +
annotate(geom = "text", x = 48, y = 80, label = "Herbivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 75, yend = 75, colour = "#756bb1", linewidth = 1.5) +
annotate(geom = "text", x = 48, y = 75, label = "Insectivorous", hjust = 0, size = 5) +
annotate(geom = "segment", x = 50.5, xend = 49, y = 70, yend = 70, colour = "#2b8cbe", linewidth = 1.5) +
annotate(geom = "text", x = 48, y = 70, label = "Omnivorous", hjust = 0, size = 5) +
# Theme
theme(axis.title.x = element_text(size = 18),
axis.title.y = element_text(size = 18),
axis.text = element_text(size = 15),
panel.background = element_blank(),
legend.position = "none",
panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.25)) +
# GTS
coord_geo(pos = list("bottom", "bottom"),
dat = list(gsc2_bis, gsc1_bis),
abbrv = list(T, F),
center_end_labels = TRUE,
height = unit(1.5, "line"),
size = "auto",
clip = "off")
fig3

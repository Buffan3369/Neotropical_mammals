################################################################################
######################< Plotting tropical RTT and LTT ##########################
################################################################################

library(ggplot2)
library(deeptime)
library(rphylopic)
library(dplyr)

## LTT -------------------------------------------------------------------------
for(order in c("Tropical_20M", "Tropical_50M", "Extra-tropical_20M", "Extra-tropical_50M")){
  dir <- paste0("../../PyRate_outputs/Tropical_analysis/LTT/", order, "/")
  files <- Sys.glob(paste0(dir, "*_ltt.txt"))
  ltt <- read.table(files[1], header = TRUE)
  ltt$time <- unlist(lapply(X = ltt$time, FUN = round, digits = 1))
  if(length(which(ltt$time > 66)) > 0){
    ltt <- ltt[-which(ltt$time > 66.0), ]
  }
  ltt <- ltt %>% rename(diversity_1 = "diversity")
  ltt <- ltt[, 1:2]
  
  i = 2
  for(file in files[2:length(files)]){
    f <- read.table(file, header = TRUE)
    if(length(which(f$time > 66.0)) > 0){
      f <- f[-which(f$time > 66.0), c("time", "diversity")]
    }
    else{
      f <- f[, c("time", "diversity")]
    }
    f$time <- unlist(lapply(X = f$time, FUN = round, digits = 1))
    colnames(f) <- c("time", paste0("diversity_", i))
    ltt <- merge(ltt, f, by = "time", all = T)
    i <- i+1
  }
  
  LTT <- data.frame(Age = ltt$time,
                    Diversity = apply(X = ltt[,c(2:ncol(ltt))],
                                      MARGIN = 1,
                                      FUN = mean,
                                      na.rm = TRUE),
                    min_Diversity = apply(X = ltt[,c(2:ncol(ltt))],
                                          MARGIN = 1,
                                          FUN = min,
                                          na.rm = TRUE),
                    max_Diversity = apply(X = ltt[,c(2:ncol(ltt))],
                                          MARGIN = 1,
                                          FUN = max,
                                          na.rm = TRUE))
  
  ltt_plot <- ggplot(data = LTT, aes(x = Age, y = Diversity)) +
    scale_x_reverse(breaks = c(2.58, 5.33, 11.63, 15.97, 23.03, 27.82, 33.9, 56, 66)) +
    # scale_y_continuous(breaks = seq(0,250,50),
    #                    limits = c(0,250)) +
    annotate("rect", xmin = 56, xmax = 65.43265, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
    annotate("rect", xmin = 23.03, xmax = 33.9, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
    annotate("rect", xmin = 2.58, xmax = 5.33, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
    geom_ribbon(aes(x = Age, ymin = min_Diversity, ymax = max_Diversity), 
                fill = "#a1d99b",
                alpha = 0.8) +
    geom_line(linewidth = 1, colour = "#329507") +
    ggtitle(order) +
    xlab("Time (Ma)") +
    ylab("Diversity (nb. lineages)") +
    theme(axis.title.x = element_text(size = 22),
          axis.title.y = element_text(size = 22),
          axis.text = element_text(size = 18),
          panel.background = element_blank(),
          panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.5),
          plot.title = element_text(size = 25, hjust = 0.5)) +
    coord_geo(dat = cnz_epochs, abbrv = TRUE, size = 5)
  ggsave(paste0("./figures/LTT_Tropical/", order, "_LTT.png"),
         plot = ltt_plot,
         height = 200,
         width = 320,
         units = "mm",
         dpi = 600)
}

## RTT (only keep 20M iterations, fair enough) ---------------------------------
  #TROPICAL
time <- c(-0.32324263000000003, -0.9697278900000001,-1.6162131500000003,-2.26269841,-2.90918367,-3.5556689300000004,-4.20215419,-4.84863945,-5.495124710000001,-6.14160997,-6.788095230000001,-7.434580490000001,-8.081065750000002,-8.72755101,-9.374036270000001,-10.020521530000002,-10.667006790000002,-11.313492050000002,-11.959977310000001,-12.606462570000001,-13.252947830000002,-13.899433090000002,-14.545918350000003,-15.192403610000003,-15.838888870000002,-16.485374130000004,-17.131859390000002,-17.77834465,-18.424829910000003,-19.071315170000002,-19.717800430000004,-20.364285690000003,-21.01077095,-21.657256210000003,-22.303741470000002,-22.950226730000004,-23.596711990000003,-24.24319725,-24.889682510000004,-25.536167770000002,-26.182653030000004,-26.829138290000003,-27.47562355,-28.122108810000004,-28.768594070000002,-29.415079330000005,-30.061564590000003,-30.708049850000005,-31.354535110000004,-32.00102037,-32.64750563,-33.29399089,-33.94047615,-34.58696141,-35.23344667,-35.87993193,-36.526417190000004,-37.17290245,-37.81938771,-38.46587297,-39.11235823,-39.758843490000004,-40.40532875,-41.05181401,-41.69829927,-42.34478453,-42.991269790000004,-43.63775505,-44.28424031,-44.93072557,-45.57721083,-46.223696090000004,-46.87018135,-47.51666661,-48.16315187,-48.80963713,-49.456122390000004,-50.10260765,-50.74909291,-51.39557817,-52.04206343,-52.688548690000005,-53.33503395,-53.98151921,-54.62800447,-55.27448973,-55.920974990000005,-56.56746025,-57.21394551,-57.86043077,-58.50691603,-59.153401290000005,-59.799886550000004,-60.44637181,-61.09285707,-61.73934233000001,-62.385827590000005,-63.032312850000004,-63.67879811000001,-64.32528337000001)
time <- abs(time)
    #Speciation
sp_rate <- c(0.5917754749478573, 0.5917754749478573,0.4640612308471681,0.4637946571945516,0.7678642058128414,0.7707452045555137,0.4068753887319775,0.1908954072758083,0.18968734176335317,0.1893609259624356,0.18935027757248407,0.18937446879754,0.1893999783578284,0.1895000036766142,0.1896586408083677,0.189791640741729,0.19007263885261466,0.19030651232567103,0.19027540685606031,0.18966527987537113,0.18934766821228105,0.18921386955142722,0.18913009460111208,0.1894302690883971,0.20833637387503565,0.8809211097806964,0.7094316811813925,0.44695750266460793,0.427438273935578,0.4140625495109792,0.40900417014939655,0.40761700363526354,0.401284612438766,0.3917679483000056,0.3800394942281858,0.36615234210807945,0.3435851937884933,0.28178705295398865,0.27685922070489843,0.2753561057163527,0.2768817876903846,0.38605202897325175,0.3906044210392777,0.3893503473203176,0.2701259356796022,0.24628523352413326,0.23639054179029328,0.2298366228644857,0.22335145526402667,0.21318863312127445,0.2091167123378403,0.20750259801001852,0.20723292418793787,0.20718808307785894,0.2078257992005645,0.20894600990928808,0.20945794062265516,0.20996630963759544,0.2104556484989761,0.21048161781558544,0.21051958526453082,0.21038366637137978,0.21045217333562366,0.21045217333562366,0.2104556484989761,0.21035572701029032,0.2105532695306822,0.21059632164325578,0.21090822178255117,0.21200002503510218,0.21326483703312082,0.21552452969538743,0.2200393759996659,0.22619303760761317,0.22993342460186575,0.23303013619660906,0.23662115629146968,0.23915772553062903,0.24481195957201374,0.2506745249720696,0.2649384740680212,0.3522576280099703,0.4352407403560366,0.47572436259982576,0.517913201850831,0.5484744208198193,0.6582305826785306,0.674276912780976,0.6611776949980276,0.6445535038413643,0.6440585690987541,0.6224634937785922,0.6224375009722596,0.6227492387645341,0.6282787511222405,0.6633093646996346,0.7681291774533043,0.9686891866496736,1.0606331699620615,1.9595697946850916)
sp_minHPD <- c(0.41201106638195206, 0.41201106638195206,0.00860799611979887,0.01033080874660405,0.4386071613558286,0.4459142358060422,0.13503457792290252,0.08456796710479023,0.14570687480436828,0.14602921243583736,0.146303787399065,0.14737962609086147,0.14752373235772048,0.14806041729336922,0.14828758246404494,0.14843520761448942,0.1479352785299622,0.14737962609086147,0.14694880964862533,0.14758087775390086,0.14543469350071297,0.14570687480436828,0.14570687480436828,0.13980153604107382,0.12425790184383986,0.39407606855454874,0.2162529738104827,0.19582345153783592,0.19633637843576968,0.19633637843576968,0.19633637843576968,0.1936341780077394,0.17944462823927146,0.1732605718638772,0.13299829699317053,0.09964548808392372,0.03759497260046703,5.8030910795002194e-05,5.8030910795002194e-05,7.164774278035644e-05,5.8030910795002194e-05,0.18503098172077787,0.18336209099481537,0.17189398743170153,0.1066674382215285,0.13394412142556314,0.12751429970013528,0.12815901947730773,0.12808506420710863,0.1165664723057739,0.1267447629740182,0.12727233730574314,0.1280574229686117,0.12808506420710863,0.13308486381736087,0.13507372780423405,0.13455697699426922,0.13609396083324993,0.13394412142556314,0.13394412142556314,0.13403173939532922,0.13424599751422198,0.13424599751422198,0.13394412142556314,0.13394412142556314,0.13394412142556314,0.13614857042071749,0.13614857042071749,0.13388159579003267,0.133626705177192,0.12815901947730773,0.11756631031519492,0.11825233021782539,0.13277559919582202,0.13196652316623647,0.13597807913132431,0.13440948313984616,0.13455697699426922,0.13196652316623647,0.1297627649902843,0.1376616731826102,0.1487180496812761,0.1544927683115681,0.1544927683115681,0.17189398743170153,0.17189398743170153,0.009317968845146265,0.009317968845146265,0.009317968845146265,0.009317968845146265,0.009317968845146265,0.1678995164405033,0.1678995164405033,0.09576593564691001,0.08929536967861487,0.009317968845146265,0.009317968845146265,0.0623402517324973,0.1684191316150876,0.20140749959068488)
sp_maxHPD <- c(0.8404321692599394, 0.8404321692599394,0.6380443631231053,0.6419824936558631,1.3310786868093272,1.3579244020534855,0.9462407536700589,0.27456266892882303,0.24049475300856055,0.2364107408277863,0.23637182049751063,0.2364107408277863,0.2364107408277863,0.2364107408277863,0.2364107408277863,0.2364107408277863,0.2363133578056113,0.23661735566947023,0.2364107408277863,0.2364107408277863,0.2364107408277863,0.23792558599896274,0.2402685034767222,0.24923886614446294,1.1319108991083364,1.5910201106143171,1.4720070130141873,0.8810072195588464,0.8007678634192433,0.7854234477061905,0.7828844461187943,0.7789604885510109,0.7737898453013284,0.7737898453013284,0.7451386988897613,0.729685967657205,0.6715721386331388,0.5393892232835011,0.5232094610440486,0.5219859212520718,0.5302523440355524,1.7477730050978737,1.7501542235406888,1.7501542235406888,0.6485561973254683,0.4964638566269541,0.4665010603449277,0.4451158191335064,0.42298836738007867,0.35693300537178246,0.32148253088058726,0.30855106323557013,0.3080258007343212,0.30646775823249817,0.30646775823249817,0.303216637251347,0.3000880575550217,0.3000880575550217,0.2972180031648839,0.2971719478057416,0.2972180031648839,0.2972180031648839,0.2973566512717435,0.2971073974733825,0.2971073974733825,0.2972180031648839,0.3006937693072728,0.3025840041382611,0.30301697781005,0.30855106323557013,0.3113784864016179,0.3286336065515355,0.43646373578418063,0.4955002461935142,0.5139535649288447,0.532134967325716,0.5434634567386772,0.5564262334730999,0.5973075893525249,0.6586602350871641,0.7784776893045459,0.942607591287556,0.9803254274599946,1.034306803349338,1.165900950692377,1.255065117282678,15409.340450336636,15409.340450336636,14201.746378152036,12418.707493429327,12418.707493429327,1.3466322866783174,1.3466322866783174,1.2919373531870573,1.3374266845344274,1.6012720962383222,2.8271888382191768,289.8249737328955,293.84449939769894,15387.418664193126)
sp_ribbon <- data.frame(time = time,
                        min = sp_minHPD,
                        max = sp_maxHPD)
    #Extinction
ex_rate <- c(0.21693913094340397, 0.21693913094340397,0.21061293546803317,0.20969156249529336,0.21721065581014562,0.22859809706615858,0.23233710727878215,0.23253349275024876,0.23272310327329362,0.22958989222467074,0.22037199399826046,0.21892582135981392,0.2183428028944701,0.21825709600949994,0.2182156385533837,0.21811777682526,0.21825709600949994,0.2207225080214661,0.22535017861268203,0.2178867663715125,0.1974717247408224,0.17397467742159162,0.16247844744364326,0.15919815504085655,0.15849998109592,0.15839020975931378,0.15849998109592,0.15938004810513934,0.15934543558322906,0.15945412754525387,0.159103921405977,0.15898400779239943,0.15899972382170108,0.15971085464142765,0.17961699946720622,0.5989061345509361,1.7046353459909716,1.6650267282605844,0.2149617689199854,0.2121484215604617,0.21205040770453742,0.21248156922199282,0.22172704520202183,0.25851171082252145,0.2509469778475042,0.21897502649835235,0.21153359447448683,0.20765259944969888,0.20510244869325955,0.2037345524995821,0.2033027285093481,0.20316385679900512,0.20300057345997147,0.20248304757433272,0.1988976060056661,0.19352488477871016,0.19095453560093079,0.1895583404520174,0.18882646215710386,0.18857101781175184,0.188435427325772,0.188435427325772,0.1884467650664885,0.1884467650664885,0.18868919457892414,0.18883367465593787,0.18903871174375264,0.18929855231015272,0.18970642982293845,0.19004336039376807,0.19059826694105958,0.19229099393174093,0.19859488250464685,0.20059614412360627,0.20318486809446337,0.20505707185274175,0.20547296632194983,0.20648802160593382,0.20812464504935263,0.21018495584697705,0.2120728947492225,0.21548063750977053,0.2172582974936629,0.22191688071077315,0.236924064715824,0.26155634156823326,0.4423832219622633,0.4537004297296966,0.45970730511998115,0.4642970230251375,0.47167010006064847,0.47979415967888067,0.4839823888026571,0.4897585309958529,0.5129173572335843,0.5951010614421561,0.710709306638643,0.9242538675788814,0.9391806877801541,1.2713518352927626)
ex_minHPD <- c(0.12871905247758395, 0.12871905247758395,0.010451322364619207,0.005586869159507549,0.024737007013987816,0.15156497683268697,0.17306037118851939,0.16796512878273295,0.17119539714824455,0.16485807511316578,0.13509765165014728,0.1447749720626827,0.1447749720626827,0.14583158756947226,0.14583158756947226,0.1447749720626827,0.1447749720626827,0.11225435089064478,0.14430406793961265,0.07603862774183669,0.07189380320748831,0.0762467311252964,0.0762467311252964,0.07583751994564013,0.07611822384926484,0.07617610483720885,0.0762467311252964,0.07585227648081995,0.07583751994564013,0.07617610483720885,0.0762467311252964,0.0762467311252964,0.07473979859337708,0.07416917911036977,0.04827483442481831,0.052234457892859576,0.0750347924316916,0.09061327448554858,0.00040809725526561106,0.00040809725526561106,4.137442272089e-05,4.137442272089e-05,4.137442272089e-05,0.14105189283960154,0.12488844428825792,0.10971291780677221,0.12128371512298669,0.12128371512298669,0.11942980978659264,0.12270584410554147,0.12496341707035877,0.12496341707035877,0.12228152906436847,0.12496341707035877,0.09536684577816837,0.07123717602389036,0.0662344677614248,0.07343950559203472,0.07343950559203472,0.07353656407373459,0.07422428802322326,0.07422428802322326,0.07422428802322326,0.07422428802322326,0.07520799230867908,0.07522641121565163,0.0750813230734903,0.07487011073164578,0.07343950559203472,0.07260315908985665,0.07345894987062557,0.0662344677614248,0.06917231001798121,0.09236502837446346,0.11278069651109243,0.12144834045277733,0.12144834045277733,0.12144834045277733,0.12523707121904243,0.12144834045277733,0.12460222365481712,0.12523707121904243,0.12460222365481712,0.12144834045277733,0.12980707072471506,0.131674668993387,0.03427990622439944,0.03427990622439944,0.046773348589715526,0.046773348589715526,0.13371765638857877,0.13371765638857877,0.13130454323573526,0.13130454323573526,0.1470129177750014,0.1539250460970243,0.15876583921170473,0.160863061472085,0.12834204006827246,0.12834204006827246)
ex_maxHPD <- c(0.29566191368941297, 0.29566191368941297,0.26955200888974223,0.26473881223117435,0.3192369046780478,0.5235165069725188,0.5484859249648619,0.5391593917152623,0.5479886358549892,0.5283105596614158,0.3367451926107162,0.3184854086351484,0.31529069561356626,0.3156185802303598,0.3159510523906934,0.3156185802303598,0.31863969859650193,0.37057756750191384,0.5638513314070422,0.4866897992675797,0.27201111409383627,0.23963906131435891,0.23417927953814666,0.23288398019520046,0.23264021372867413,0.23264021372867413,0.2325448923918464,0.2325448923918464,0.23307656031559393,0.23443103129744405,0.2353201328370872,0.23594524262718614,0.23594524262718614,0.2402247876807014,1.376905869144881,2.619443670352559,3.3407789234155385,3.40963386114942,1.2074170076510007,0.42909182831710146,0.42927474679373284,0.4314953096724537,0.8819257689939575,2.896567364694855,2.8835115571317727,0.790087888640167,0.44409161717711626,0.39551986076175394,0.3750008488985305,0.36991110359048124,0.36991110359048124,0.36991110359048124,0.36619691324123915,0.36991110359048124,0.34845826472129576,0.2801871831615666,0.26158313034650194,0.26161696715676724,0.25914551980472333,0.25903436634904237,0.2596224062488233,0.2596224062488233,0.2596224062488233,0.2596577337386007,0.26000904862230334,0.2601092412121411,0.2601092412121411,0.2601092412121411,0.25903436634904237,0.2601092412121411,0.2638789318598008,0.26887865429440255,0.3944883730287081,0.4428719093773488,0.4642075005615148,0.47504513964868156,0.4752400135445016,0.48113298114077174,0.49692855866106506,0.5165577175487013,0.5422611617492227,0.583744537931414,0.6015422844705156,0.6624875045985257,0.8317714430073692,0.8982664409728904,28268.640100363464,28268.640100363464,40789.06052345056,40789.06052345056,1.4177185605238556,1.424680539754649,1.4177185605238556,1.4339912143133897,1.5087036007708408,1.7690896128320812,2.1709803569818003,6152.10490660196,11480.291634270952,22291.869466794065)
ex_ribbon <- data.frame(time = time,
                        min = ex_minHPD,
                        max = ex_maxHPD)

    #Restrict rates and ribbons to 2.1
sp_ribbon$max[which(sp_ribbon$max > 2.1)] <- 2.1
ex_ribbon$max[which(ex_ribbon$max > 2.1)] <- 2.1
sp_rate[which(sp_rate > 2.1)] <- 2.1
ex_rate[which(ex_rate > 2.1)] <- 2.1

rates <- data.frame(time = time,
                    sp_rate = sp_rate,
                    ex_rate = ex_rate)
    #Plot
sp_ex <- ggplot(data = rates, aes(x = time, y = sp_rate)) +
  scale_x_reverse(breaks = c(2.58, 5.33, 11.63, 15.97, 23.03, 27.82, 33.9, 56, 66)) +
  scale_y_continuous(breaks = seq(from = 0, to = 2, by = 0.5),
                     limits = c(0, 2.1)) +
  annotate("rect", xmin = 56, xmax = 65.43265, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 23.03, xmax = 33.9, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 2.58, xmax = 5.33, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  geom_ribbon(data = sp_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#4c4cec",
              alpha = 0.2) +
  geom_ribbon(data = ex_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#e34a33",
              alpha = 0.2) +
  geom_line(aes(x = time, y = sp_rate),
            linewidth = 1, colour = "#4c4cec",) +
  geom_line(aes(x = time, y = ex_rate),
            linewidth = 1, colour = "#e34a33") +
  labs(x = "Time (Ma)",
       y = "Rate (event/lineage/Myr)") +
  theme(axis.title.x = element_text(size = 22),
        axis.title.y = element_text(size = 22),
        axis.text = element_text(size = 18),
        legend.text = element_text(size = 10),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.5),
        plot.margin = margin(t=1, b=1, unit = "cm")) +
  coord_geo(dat = cnz_epochs, abbrv = TRUE, size = 5)
    
    #Net diversification
net_rate <- c(0.39140845002190827, 0.39140845002190827,0.17333372198896727,0.1767702940115329,0.5933430490669244,0.5447495303220684,0.14628148094278917,-0.07037260274790498,-0.08588095189552036,-0.07690869135127647,-0.03910095947464417,-0.033274026909430515,-0.031420730781725005,-0.030893846701834524,-0.030467909434282268,-0.030254008185663414,-0.029348622598301857,-0.04309356960599192,-0.06778048979306307,-0.04834484278222623,0.00533901481546586,0.025435420157500107,0.029680167459914465,0.03534864124161549,0.23381832940331762,0.7668984297004711,0.6336060621171307,0.32365542483291165,0.2944550897901656,0.27642445530374027,0.26996385342841134,0.2687131155095561,0.2610058459447866,0.24493845598922007,0.09020043632268109,-0.5499277403642544,-1.4189838896539229,-1.4425183073463017,-0.020554074064847883,0.06900720614181471,0.07749886422717621,0.38245474868920026,0.3169655875967829,-0.0619202858524114,-0.2966575153899658,-0.01469044827723633,0.01755367255654992,0.021553009418231746,0.01751428026399366,0.003004861970204223,-0.0036000741823925923,-0.006366728855978129,-0.006647581832007263,-0.00581650287147883,0.005511386024488631,0.019328748443578746,0.025964897633228567,0.02928960824046473,0.03135444740392028,0.03142617419067627,0.03163647657456623,0.031486408720715564,0.031435576452218325,0.03134319437678327,0.030885279910270666,0.030411836610143544,0.02999944872242921,0.02998442484621133,0.03076141908669643,0.03260804443183103,0.033855640988432294,0.03418540924321801,0.024809917712099675,0.030494846235900975,0.03078181206234014,0.03350764178819101,0.04032539797786235,0.04281354236957232,0.052873454133805335,0.06494940085984646,0.09751266607438674,0.17469829426064873,0.20664452539139555,0.22280128191136916,0.23229941927052314,0.23235421644133952,-1720.1348857381283,-1720.135355557186,-3492.5561486115175,-3433.6878087699697,1759.3784599036567,0.07497046526893221,0.07654904632880877,0.07206503823474505,0.05758420312109832,0.020110172928529933,0.12021632631224832,-1068.849180194106,-1460.2436666274018,-1335.1010721848597)
net_minHPD <- c(0.19699354531295565, 0.19699354531295565,-0.21229714334412764,-0.2105789857675881,0.21708897895414958,0.20929812314556184,-0.41845522932116036,-0.5638595908962166,-0.38031880709634147,-0.338726576738608,-0.14664709721289845,-0.12807129472931925,-0.1311284404737817,-0.12807129472931925,-0.12681201169638415,-0.12563447462556196,-0.13078564349445312,-0.19823088677746944,-0.3934702792111149,-0.3198709031567217,-0.0933250255476645,-0.06521933916539763,-0.05994738358130841,-0.061401741051953174,-0.08251145111398417,0.21020480440194741,0.03156632584623725,-0.009805891376967135,-0.00016904663701622358,-0.00927045088292923,-0.017641108379441023,-0.01768976211305004,-0.03256769150064043,-0.0543192649693123,-1.0506539957231449,-2.2861956544316877,-3.1202587342682375,-3.110150441325413,-0.8896162218019865,-0.12094662605032258,-0.13193143947942854,-0.16007207726930547,-0.1924871294808419,-1.513620714809298,-2.5599486382540255,-0.6330161409645033,-0.21989411644899312,-0.19066143308825814,-0.19466770782770632,-0.21500452834455402,-0.211795192145311,-0.20233158502591597,-0.20024145945630517,-0.20298991143278833,-0.16749480823329319,-0.09475801825415103,-0.07537451111514379,-0.06918675500051943,-0.06933165503782829,-0.06729233333008722,-0.06729233333008722,-0.06715129660745395,-0.06733725322703399,-0.06715129660745395,-0.06634158098372658,-0.06598392317785709,-0.06729233333008722,-0.07065948542768513,-0.06933165503782829,-0.08194305454760134,-0.08690071984383915,-0.12498817562086509,-0.2573834434840573,-0.2639791887123022,-0.15758811506731307,-0.14746968614238903,-0.1476823616187128,-0.14947811086903784,-0.16318140383661633,-0.15758811506731307,-0.17579114037159593,-0.15852068840968414,-0.1500454443912842,-0.1777455978441096,-0.3176747799563593,-0.3978411517602721,-13622.94328502866,-13622.94328502866,-32984.77951494418,-23776.235173195586,-4.921184084093039,-0.7628645320838972,-0.7517918081494431,-0.7652346346411121,-0.8324888745662986,-1.2390868675986317,-1.2730085298121243,-5886.841251505589,-11242.937531302676,-7282.051542949577)
net_maxHPD <- c(0.6199165863304628, 0.6199165863304628,0.44955340948032785,0.4482857229336395,1.195107135765717,1.0597516046574884,0.72157516983385,0.07305340000792429,0.04322121654737254,0.04322121654737254,0.06438093553920558,0.05558747949468881,0.048442180601645596,0.05050406089462356,0.053482705427063446,0.05558747949468881,0.058342750009984484,0.09038051547358486,0.05988704798839564,0.11734657971009778,0.11951456582486045,0.12063748211835264,0.12327468023436694,0.13144839965849173,0.9270575396895508,1.418517925151729,1.329717515025352,0.7229921795640988,0.650400613467115,0.6287660469755164,0.621154613491532,0.621154613491532,0.6187286526640534,0.6221080050264907,0.6713735190020189,0.6804897941157111,0.3098993148939374,0.22068131910942357,0.3466169126077584,0.30810051091877,0.30815996980720395,1.7207844846467755,1.745899214127451,0.9601966543604236,0.47900283901251817,0.32889207630236855,0.24861177901276224,0.2249855491206172,0.19116969335143613,0.13318579684071463,0.10943053063249886,0.11300714594597075,0.11295577224283615,0.10789042807839636,0.12148030318075265,0.12753998237216668,0.12524897196249435,0.1242566680194542,0.1241935674175561,0.12524897196249435,0.12524897196249435,0.12524897196249435,0.12555079629688357,0.12524897196249435,0.12524897196249435,0.12524897196249435,0.12524897196249435,0.12713692461978937,0.13539622832053635,0.13665218958898068,0.14312203012845268,0.1745905173538484,0.17161036868445093,0.22757866782285266,0.22840981130517357,0.25055044517097763,0.284511573545574,0.30706724959856013,0.40353979467937917,0.5027063711285096,0.6489312161482153,0.8402096198925343,0.8164650103663671,0.8658599651779244,0.9465081666618523,1.075009937882474,4.382182403145428,3.289182692599291,3.065149761662532,4.589529786937917,12417.502329849101,0.8609046912336722,0.8593985862872956,0.8500280187737284,0.9525569297865342,1.159723781963942,1.8114678502327561,4.409884804755494,4.409884804755494,6.723040846651582)
net_ribbon <- data.frame(time = time,
                         min = net_minHPD,
                         max = net_maxHPD)
    #Restrict ribbon
net_ribbon$max[which(net_ribbon$max > 2.1)] <- 2.1
net_ribbon$min[which(net_ribbon$min < -2.1)] <- -2.1
net_rate[which(net_rate > 2.1)] <- 2.1
net_rate[which(net_rate < -2.1)] <- -2.1

net_rate_df <- data.frame(time = time,
                          net_rate = net_rate)

net_plot <- ggplot(data = net_rate_df, aes(x = time, y = net_rate))+
  scale_x_reverse(breaks = c(2.58, 5.33, 11.63, 15.97, 23.03, 27.82, 33.9, 56, 66)) +
  scale_y_continuous(breaks = seq(from = -2, to = 2, by = 0.5),
                     limits = c(-2.1, 2.1)) +
  annotate("rect", xmin = 56, xmax = 65.43265, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 23.03, xmax = 33.9, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 2.58, xmax = 5.33, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  geom_ribbon(data = net_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#504A4B",
              alpha = 0.2) +
  geom_line(aes(x = time, y = net_rate),
            linewidth = 1, colour = "#504A4B") +
  geom_hline(yintercept = 0,
             linetype = "dashed", colour = "red") +
  labs(x = "Time (Ma)",
       y = "Rate (event/lineage/Myr)") +
  theme(axis.title.x = element_text(size = 22),
        axis.title.y = element_text(size = 22),
        axis.text = element_text(size = 18),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.5),
        plot.margin = margin(t=1, b=1, unit = "cm")) +
  coord_geo(dat = cnz_epochs, abbrv = TRUE, size = 5)

p <- ggarrange2(sp_ex, net_plot, nrow = 2, labels = c("Sp/Ex rates", "Net divers. rate"))
ggsave(plot = p,
       filename = "./figures/LTT_tropical/Tropical_RTTs.png",
       height = 300,
       width = 400,
       unit = "mm",
       dpi = 600)

rm(time, rates)
rm(list = ls(pattern = "sp_"))
rm(list = ls(pattern = "ex_"))
rm(list = ls(pattern = "net_"))

  #EXTRA-TROPICAL
time <- c(-0.32585403, -0.97756209,-1.62927015,-2.2809782100000002,-2.93268627,-3.5843943300000003,-4.23610239,-4.88781045,-5.53951851,-6.1912265699999995,-6.84293463,-7.49464269,-8.14635075,-8.79805881,-9.44976687,-10.10147493,-10.75318299,-11.40489105,-12.05659911,-12.70830717,-13.36001523,-14.01172329,-14.66343135,-15.31513941,-15.96684747,-16.618555530000002,-17.270263590000003,-17.921971650000003,-18.573679710000004,-19.22538777,-19.877095830000002,-20.528803890000002,-21.180511950000003,-21.832220010000004,-22.48392807,-23.13563613,-23.787344190000002,-24.439052250000003,-25.090760310000004,-25.74246837,-26.39417643,-27.045884490000002,-27.697592550000003,-28.349300610000004,-29.001008670000004,-29.65271673,-30.304424790000002,-30.956132850000003,-31.607840910000004,-32.25954897,-32.91125703,-33.56296509,-34.21467315,-34.86638121,-35.51808927,-36.16979733,-36.82150539,-37.47321345,-38.12492151,-38.77662957,-39.42833763,-40.08004569,-40.73175375,-41.38346181,-42.03516987,-42.68687793,-43.33858599,-43.99029405,-44.64200211,-45.29371017,-45.94541823,-46.59712629,-47.24883435,-47.90054241,-48.55225047,-49.20395853,-49.85566659,-50.50737465,-51.15908271,-51.81079077,-52.46249883,-53.11420689,-53.76591495,-54.41762301,-55.069331070000004,-55.72103913,-56.37274719,-57.02445525,-57.67616331,-58.327871370000004,-58.97957943,-59.63128749,-60.28299555,-60.93470361,-61.586411670000004,-62.23811973,-62.88982779,-63.54153585,-64.19324391,-64.84495197)
time <- abs(time)
#Speciation
sp_rate <- c(0.24436856122606906, 0.24436856122606906,0.24397253512581635,0.24350335830104802,0.23906637658730792,0.1847322427277483,0.15229176528274035,0.14404116434386788,0.14280581496619377,0.13882556331626486,0.13742857588199323,0.13713331610291835,0.13701259383115416,0.13696314597875936,0.13694445615995565,0.13694445615995565,0.13693913996929447,0.9566984811819592,1.0629736111472168,0.07880748718552472,0.07711560304466089,0.0771173657715083,0.07711940137430058,0.07711940137430058,0.07711940137430058,0.07712189351535703,0.0771173657715083,0.0771173657715083,0.0771173657715083,0.07711940137430058,0.07712633394599727,0.07713387815617992,0.07715154831927964,0.08360877146152047,0.4388260112143809,0.699188060977505,0.37966295659935934,0.07627344654343202,0.0757291528460414,0.0784467763675489,0.08466938191110704,0.1611924479811587,0.42689186669744494,0.4056181353681414,0.15917537897957412,0.12485877032304464,0.12391211528599995,0.1235360910706956,0.12318929290115935,0.12257512558952122,0.12172331480765602,0.12093509503030711,0.11945790913039961,0.11745611077221474,0.11452990660658573,0.11286397515429394,0.11158974132828411,0.11022540019264734,0.10772537672500554,0.10432648313444756,0.10154242106918775,0.10032275162144477,0.10001542312577302,0.09974298062825845,0.09958869215223302,0.09950010220802362,0.09949219049626155,0.09948876004902624,0.09948425866143207,0.09948555402243398,0.09949219049626155,0.09950891508664185,0.09952347117176803,0.09953785897202898,0.09952347117176803,0.09948555402243398,0.09947642364363529,0.09940732977373788,0.09939348072625422,0.09939348072625422,0.09940209364150834,0.09942454830247965,0.09949219049626155,0.09964333716686727,0.1036416301912623,0.10981586150401304,0.13479473896401767,0.3372046612787924,0.3652500343443685,0.36095268578526263,0.36034543715849765,0.359458508905049,0.3597717251836646,0.36137889979801496,0.3615153170104004,0.3648470645944117,0.3709846395642665,0.3754012175259902,0.3808851158905827,0.4704975158676783)
sp_minHPD <- c(0.14235984066853125, 0.14235984066853125,0.14263146558811754,0.14263146558811754,0.1396536137951751,0.10756715131734727,0.09354112670563222,0.08720662171351395,0.08479029304616777,0.08786645520447403,0.08850807894960044,0.08916470959066487,0.08950568468618844,0.08912678541809582,0.08950568468618844,0.08912678541809582,0.08931226115092318,0.10294862559952331,0.7691272931355242,0.04555180946092917,0.05334029876355929,0.05334029876355929,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053423951582529584,0.053349151834473744,0.05344318298052166,0.05527812280576347,0.05024102064965797,0.05296869241033112,0.3553422852724972,0.004607341381858583,0.003047962082568248,0.0026813082560279704,0.003735438812604412,0.0026700944487377484,0.004187232807389957,0.11023489775478947,0.10328385574054368,0.08003963755227354,0.08417991492684944,0.08494604790805473,0.08480027319316422,0.08553438412877927,0.08417991492684944,0.08443065436143964,0.08422796220367129,0.08320287259545298,0.0817067276211358,0.07931899036609968,0.07874411382152452,0.07580823729441732,0.07580823729441732,0.0703734358040611,0.06594852959562612,0.0610521183940815,0.06451681910015461,0.06431347844564231,0.06431347844564231,0.06567597532083241,0.0659493058351785,0.06613956211844392,0.06618741849422936,0.06567597532083241,0.06567597532083241,0.06567597532083241,0.06569207051231248,0.06574765092641376,0.06567597532083241,0.06533752944833851,0.06528242423370968,0.06579871805258422,0.06479329892245805,0.06475359259590437,0.06463283512517025,0.06451681910015461,0.06431347844564231,0.06431347844564231,0.06463283512517025,0.05820692188701487,0.05390240923184462,0.06067133697901659,0.06992518596475703,0.06992518596475703,0.07042037160870493,0.0662897514538121,0.06992518596475703,0.06992518596475703,0.06992518596475703,0.0708716511577165,0.07042037160870493,0.0708716511577165,0.06338395385086357,0.06604722284901964,0.033071933039845895)
sp_maxHPD <- c(0.34786224954703027, 0.34786224954703027,0.34766997619044526,0.34766997619044526,0.347715931092748,0.322110406490681,0.27043667045811703,0.22765819263817536,0.21867237934984848,0.19350713314821227,0.18816659876360883,0.1878749425106304,0.18816659876360883,0.18766356842434787,0.18816659876360883,0.18789362436791276,0.18816659876360883,1.3153918875948072,1.3711477758973105,0.9821746514422581,0.0985085447139142,0.09849130117881441,0.0985085447139142,0.0985085447139142,0.09849130117881441,0.09849130117881441,0.09849130117881441,0.09849130117881441,0.09849130117881441,0.0985085447139142,0.09851506750789156,0.09875512575266475,0.1009016800266222,0.5444700314186324,0.8026447557896347,1.0782746047062273,1.038965198169246,0.19780093242553853,0.19432449524411702,0.19661825465524668,0.20736971798146397,0.5573682726681375,0.8024288399374057,0.8060485056003752,0.5618392603167873,0.20915868098902382,0.20508762844777725,0.20355769679941935,0.20378607685259933,0.20042334066872933,0.20015513849267907,0.19870194194717342,0.19661825465524668,0.19351710037922437,0.190259385562588,0.18796755497892528,0.18461892170761945,0.18377925017037922,0.17625356071334444,0.16444183946854254,0.13873745788350708,0.13236161594385518,0.13019089701402425,0.1292994035077935,0.13014001829497762,0.13014001829497762,0.13014001829497762,0.13014001829497762,0.1295923480146047,0.1294690654766938,0.12938865716671596,0.12938865716671596,0.1294052499166877,0.12938865716671596,0.1292994035077935,0.1294052499166877,0.13014001829497762,0.1294052499166877,0.1294052499166877,0.1294052499166877,0.1294052499166877,0.1294690654766938,0.13028756801494656,0.13210582787908257,0.4222448017996268,0.5178594490741973,0.7140643418274258,0.7504742261805887,0.7377317322763098,0.7191092327776922,0.7129918949225159,0.7158276057090366,0.7210025145672814,0.7258355637570326,0.7306123174196951,0.7459445956073498,0.767410413552377,0.803497390240886,0.8733437899480906,8.86637448562961)
sp_ribbon <- data.frame(time = time,
                        min = sp_minHPD,
                        max = sp_maxHPD)
#Extinction
ex_rate <- c(0.40771420051292984, 0.40771420051292984,0.40585048549386493,0.4055531046117343,0.40874087760022915,0.4096672320564055,0.3590409934487328,0.21139447083628668,0.2074035470530481,0.189629953654174,0.15305025468119518,0.14512259033749567,0.13601654916123346,0.12935215834033587,0.1276408870470166,0.12681064989172264,0.12822463609157791,0.1422453407592929,0.2596021451546341,0.2705889810663945,0.2712720227733923,0.27132391002054823,0.2713436038945082,0.27165076577029107,0.27659513782727596,0.26651001032839616,0.08228960914464803,0.06809129128756297,0.06262942764097634,0.061403729857827674,0.059618771933336076,0.05956170551595606,0.05946581307147715,0.05944395968905468,0.059641613009278775,0.4067593456794829,0.44513770019565924,0.1395758825853125,0.11586559622541803,0.11485577391382869,0.11495292563075438,0.11543036820641431,0.12002745523038667,0.12854497221161165,0.13243189762244062,0.13365008993232824,0.1350025440730982,0.13559103822977497,0.13630247952967361,0.13911714392937016,0.14582578613639424,0.17581518699900053,0.19646149133702298,0.19879186218031744,0.2001912147266905,0.20310466493281015,0.20924633582644384,0.2388803825833408,0.24746065724372962,0.18830546021767142,0.042297881213973,0.03978111914737363,0.03964420205799089,0.039635447188076295,0.03960903230936261,0.03949352634484187,0.03949558985379144,0.03949352634484187,0.0394918291879601,0.039490695151941604,0.03949026861307967,0.03948997776422907,0.03945693575491113,0.03938108663508151,0.039284209951192466,0.03926354265545435,0.03922210663620361,0.039185728987379057,0.039139400707521824,0.03908713902424198,0.039054656406667276,0.03904023951529363,0.03901146336929584,0.0390008605761682,0.03899997642311043,0.038999268871544354,0.03899997642311043,0.038980665138386834,0.03899997642311043,0.039058700702968845,0.039164045108538215,0.039599934794117414,0.04012078053132821,0.042336183374300326,0.0450174938639957,0.17964552611117246,0.18303640647721822,0.1882918095596925,0.1882918095596925,0.32321869886880294)
ex_minHPD <- c(0.3002959405148346, 0.3002959405148346,0.2990826149883925,0.2990826149883925,0.2990826149883925,0.2990826149883925,0.12337691994059394,0.12504966881819843,0.12467455738258455,0.10596703921439718,0.07402813628266118,0.07472833364842031,0.06761117543996206,0.06191915597607945,0.05695541630690684,0.06041320713933177,0.05436172875672457,0.06256283244788967,0.10743276779946356,0.1513322244919323,0.1588293337510011,0.1588293337510011,0.1588293337510011,0.1588293337510011,0.15822303048691305,0.039313589768112396,0.03703141330698142,0.031887645437366746,0.02845556125926554,0.016292621601573642,0.030743880350552217,0.030743880350552217,0.030743880350552217,0.030419578699899225,0.027056704859105305,0.03198559972386705,0.14555477330862973,0.056026118677409635,0.012681455564084754,0.014945050199282741,0.015144334296239173,0.01763540625466551,0.043470976308272104,0.06742266382336089,0.07595279337708165,0.07652437036121368,0.07698821560290603,0.07652437036121368,0.07686674412274765,0.07481571590721012,0.07575955855820647,0.08785602251835799,0.10807215019744902,0.10988389722673307,0.1080908391976633,0.1119592509345485,0.11401432817404898,0.12258818166727589,0.1249365257306268,0.02176848329999814,0.02116169057423916,0.022077994623061804,0.023492015275269534,0.02329722314567519,0.023489548614962087,0.023642727489566293,0.024049885313662273,0.024049885313662273,0.023642727489566293,0.02439553201916052,0.023663599652360628,0.02439553201916052,0.023678693359232908,0.023663599652360628,0.023603526712037564,0.023624334735945777,0.023489548614962087,0.023327986889814363,0.023110620749702444,0.023327986889814363,0.023110620749702444,0.023158846469926112,0.023389033351595822,0.023447173868780955,0.023329882299171364,0.023327986889814363,0.02324575565526994,0.022886755838179226,0.02254406692486435,0.02119789678371609,0.02098397938173984,0.005823235637512462,0.0001566527750993381,0.0037466226831799052,0.007452209625244351,0.010233578183706502,0.010233578183706502,0.010835834753569121,0.010835834753569121,0.012480049665403087)
ex_maxHPD <- c(0.5276530696195364, 0.5276530696195364,0.5252404620437026,0.5251796759029238,0.5397884199323634,0.5442992717314284,0.4885749199135605,0.40593109264565275,0.40293287702572983,0.39815420857675965,0.2618967809307486,0.2275610070781121,0.21436313311073213,0.20741682740196962,0.20300965458496376,0.20885344927726182,0.20885344927726182,0.29753333968704493,0.34504683066210395,0.3455682865851317,0.3477813250213436,0.3466146952807304,0.34648915814734904,0.3467618027429312,0.3710141559016991,0.3901949461462686,0.29889927487836276,0.2540451082205265,0.18985002822426011,0.1606979333582815,0.0885462800147789,0.08842252424048637,0.08853155512019883,0.0885462800147789,0.09141682584477145,0.6631276199428302,0.689932999080425,0.5220502071775778,0.19709500362467522,0.19410646016432803,0.19406204931413898,0.1964097851822326,0.21574927825682608,0.2127405475118969,0.21794794879640897,0.21794794879640897,0.21794794879640897,0.21819778963525996,0.21966823605984245,0.2227205047341918,0.24392414470424595,0.2982151925050569,0.31093057740346774,0.31103566557516216,0.3110591191559468,0.3179602805874793,0.3335379132651954,0.6259302437734302,0.6300409278313293,0.33014327867414556,0.20696417502844672,0.06242669084360783,0.05996215473616494,0.05947623712795997,0.059164964967406614,0.05859846628697425,0.058965301023774355,0.058948151359208445,0.05852320051410526,0.059187249085333696,0.0584931930354991,0.059164964967406614,0.05847699123050131,0.05851316117489169,0.05851316117489169,0.05851316117489169,0.05851316117489169,0.05847699123050131,0.05851316117489169,0.05909031176512505,0.0593264623269282,0.05947623712795997,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.05996215473616494,0.06259164174849452,0.06612861954771196,0.19371157649502294,0.37360567150561236,0.46418744143954316,0.8713802475630894,0.8601099272010765,0.8637978567761659,0.8596728632822093,11.640790107473626)
ex_ribbon <- data.frame(time = time,
                        min = ex_minHPD,
                        max = ex_maxHPD)

#Restrict rates and ribbons to 2.1
sp_ribbon$max[which(sp_ribbon$max > 2.1)] <- 2.1
ex_ribbon$max[which(ex_ribbon$max > 2.1)] <- 2.1
sp_rate[which(sp_rate > 2.1)] <- 2.1
ex_rate[which(ex_rate > 2.1)] <- 2.1

rates <- data.frame(time = time,
                    sp_rate = sp_rate,
                    ex_rate = ex_rate)
#Plot
sp_ex <- ggplot(data = rates, aes(x = time, y = sp_rate)) +
  scale_x_reverse(breaks = c(2.58, 5.33, 11.63, 15.97, 23.03, 27.82, 33.9, 56, 66)) +
  scale_y_continuous(breaks = seq(from = 0, to = 2, by = 0.5),
                     limits = c(0, 2.1)) +
  annotate("rect", xmin = 56, xmax = 65.43265, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 23.03, xmax = 33.9, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 2.58, xmax = 5.33, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  geom_ribbon(data = sp_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#4c4cec",
              alpha = 0.2) +
  geom_ribbon(data = ex_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#e34a33",
              alpha = 0.2) +
  geom_line(aes(x = time, y = sp_rate),
            linewidth = 1, colour = "#4c4cec",) +
  geom_line(aes(x = time, y = ex_rate),
            linewidth = 1, colour = "#e34a33") +
  labs(x = "Time (Ma)",
       y = "Rate (event/lineage/Myr)") +
  theme(axis.title.x = element_text(size = 22),
        axis.title.y = element_text(size = 22),
        axis.text = element_text(size = 18),
        legend.text = element_text(size = 10),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.5),
        plot.margin = margin(t=1, b=1, unit = "cm")) +
  coord_geo(dat = cnz_epochs, abbrv = TRUE, size = 5)

#Net diversification
net_rate <- c(-0.172414361736995, -0.172414361736995,-0.17041342093504472,-0.17028311542609656,-0.1805419219831153,-0.21404923106464743,-0.16956960349566252,-0.10355298681858273,-0.10176876054194334,-0.08298289066510418,-0.021181293103286362,-0.011056262875078946,-0.00036978691847275595,0.006652539854938609,0.00786084488380282,0.008674048789020733,0.006161942282712233,0.5886179703985527,0.8161246076505966,-0.07240177356838148,-0.18518781607206192,-0.1852261314548077,-0.18524537011554698,-0.1856714184857869,-0.19827801858574964,-0.17823422050597307,-0.06571598817856782,-0.022209111243179914,0.004946989228296361,0.010873205203634594,0.017706884106332386,0.018023468359988134,0.018386369684954027,0.11943144011152396,0.32439582426733465,0.3343983127874267,-0.007238713045328741,-0.10743093869030894,-0.022761271532284476,-0.016227682003240033,-0.007262601131440016,0.08840104263047889,0.29254686431323296,0.26818739803771346,0.07315172568710612,-0.00012233212413610976,-0.004191976361881616,-0.005358640187812413,-0.006288717506763092,-0.009627253583805192,-0.018663588688279196,-0.04811700385427971,-0.07155359670743029,-0.07616738019601943,-0.08137929334233755,-0.08697207284303712,-0.09552705738660586,-0.1598582828201146,-0.1778491914411607,-0.0603171673815197,0.03499655404256998,0.056678841880167245,0.05802621196294249,0.05787740796028382,0.057925954406705525,0.05851346061612791,0.05847877643859256,0.058470202094752684,0.058462811148134175,0.05847861053142069,0.058525624690712374,0.058577800386598065,0.05862602756988476,0.05873290535644187,0.05882222724306727,0.058804813678403824,0.05886585417868738,0.05881843345309111,0.05887497664272616,0.059015172623814345,0.059166848755278195,0.05947626686811187,0.05987701704581616,0.0612145196737606,0.09933599659917072,0.14849128644668008,0.26006788185709295,0.2997594259315265,0.3094101744783805,0.30074313106389394,0.29802028622686144,0.29196184807225545,0.2846868247158394,0.2528641970851274,0.21957997881916527,0.06782895908260839,0.07967489812977442,0.09270868933898564,0.11390409727702812,-0.20872855382279606)
net_minHPD <- c(-0.33510923677772037, -0.33510923677772037,-0.333567306333078,-0.33481881486003773,-0.33510923677772037,-0.3909983587632858,-0.37694738140495765,-0.28360442935839003,-0.27911480583212034,-0.27465872884206216,-0.15351380455858574,-0.12082196899419842,-0.08122022478749563,-0.06368220668096479,-0.06265935453788854,-0.06251700048054837,-0.07419048178510612,-0.09917218489264065,0.5178787764855658,-0.3080581858110171,-0.27744536862926483,-0.27288814588978383,-0.27332330145899175,-0.27332330145899175,-0.30080689679993466,-0.3196683567893245,-0.21806375435330766,-0.1788738664641441,-0.11244712113610099,-0.0660838457884277,-0.017124971978227536,-0.016793570962503085,-0.016821238933052027,-0.01691122355219507,-0.01469858667070445,-0.17740045729488774,-0.5514683495432113,-0.49161694053817484,-0.13476275932620893,-0.1283098843946366,-0.13103698389168045,-0.13035247332818775,-0.04061013723590792,-0.04514718157911772,-0.12999674253721263,-0.12060564607250936,-0.11994447055598355,-0.11969843996428801,-0.12043154803175428,-0.12060564607250936,-0.1378969432600478,-0.17019652163447285,-0.19156813043991122,-0.19189899289577497,-0.19646789872717235,-0.20660846918613449,-0.22264160678729655,-0.5180268660457074,-0.5376916474672289,-0.24519004751155596,-0.11929663094211292,0.02008791835131714,0.023223721470838607,0.023835400303588904,0.022791603491812452,0.02479662569422067,0.024691994450220675,0.02525911119207267,0.02626634862792461,0.025476428794654706,0.02613587778335797,0.02626634862792461,0.02626634862792461,0.02626634862792461,0.02626634862792461,0.02613587778335797,0.025476428794654706,0.02525911119207267,0.02626634862792461,0.026901362182330316,0.02689338528661534,0.02626634862792461,0.02626634862792461,0.02411041949300656,0.013492266389939604,0.014585093816298834,0.015520136416910121,0.02317996063917792,0.03056150299871977,0.02317996063917792,0.02423093578916455,0.02479662569422067,0.025849408448866837,-0.0271768581230028,-0.08530571798051384,-0.372021799054141,-0.375412983306304,-0.40612063522016584,-0.4065547717781359,-3.855210890518898)
net_maxHPD <- c(-0.02125736676211687, -0.02125736676211687,-0.022304769498271815,-0.02364158519340609,-0.006175915596513815,-0.029755908041403656,0.04705303362051766,0.03951603146490271,0.04016033564397878,0.05065477706299665,0.08765651921095853,0.07916556879923234,0.08266237580611462,0.08082040753198902,0.08082040753198902,0.08250692922460494,0.08266237580611462,1.1933795407723946,1.1097293909048593,0.7928293621882884,-0.07855063161818046,-0.074605374124693,-0.07543610595686216,-0.07563782878715049,-0.07517831809219114,0.044817728319672304,0.043366865446403224,0.05507565655538614,0.05541446694166962,0.07549887232744398,0.05346686481830465,0.05346686481830465,0.054247061514880325,0.4928196885602994,0.7661874045971319,0.9577552441939482,0.6779992230826813,0.09751853999395703,0.09608945571806043,0.09624779852023012,0.11027739132356298,0.461398262387746,0.7188912872984248,0.6714683320680137,0.45125369002389215,0.1047729774386964,0.09960339507550234,0.09833326167727134,0.09833326167727134,0.10136992960511557,0.0946315522857088,0.08564328078624854,0.058213365576413406,0.05635746218377012,0.050988711763884254,0.045400006427063974,0.04569158479862377,0.00846896064332689,-0.0035444768328951326,0.1280598262676365,0.10654530943807411,0.0994870457156134,0.09196222421153863,0.0905084493321261,0.08816216756539241,0.08787201413196488,0.08752353516102804,0.08787201413196488,0.08878103743263367,0.08787201413196488,0.08816216756539241,0.08807189571760411,0.08810959435578095,0.08816216756539241,0.08807189571760411,0.08831271648800494,0.08787201413196488,0.08807189571760411,0.08925443316178355,0.09022597402808383,0.0905084493321261,0.09024914193469005,0.09139169620462435,0.09115819596416323,0.37692978988049697,0.482168668984189,0.6759653191610779,0.7099469642328171,0.7081279861789469,0.681346835367673,0.6832768159358619,0.6898508830673872,0.7072293245321176,0.7296141556127209,0.758252174662964,0.49266722969824633,0.5018069089632287,0.522909535864718,0.6365696717955035,2.979211334520185)
net_ribbon <- data.frame(time = time,
                         min = net_minHPD,
                         max = net_maxHPD)
#Restrict ribbon
net_ribbon$max[which(net_ribbon$max > 2.1)] <- 2.1
net_ribbon$min[which(net_ribbon$min < -2.1)] <- -2.1
net_rate[which(net_rate > 2.1)] <- 2.1
net_rate[which(net_rate < -2.1)] <- -2.1

net_rate_df <- data.frame(time = time,
                          net_rate = net_rate)

net_plot <- ggplot(data = net_rate_df, aes(x = time, y = net_rate))+
  scale_x_reverse(breaks = c(2.58, 5.33, 11.63, 15.97, 23.03, 27.82, 33.9, 56, 66)) +
  scale_y_continuous(breaks = seq(from = -2, to = 2, by = 0.5),
                     limits = c(-2.1, 2.1)) +
  annotate("rect", xmin = 56, xmax = 65.43265, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 23.03, xmax = 33.9, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  annotate("rect", xmin = 2.58, xmax = 5.33, ymin = -Inf, ymax = Inf, alpha = 0.2, fill = "grey40") +
  geom_ribbon(data = net_ribbon, aes(x = time, ymin = min, ymax = max),
              fill = "#504A4B",
              alpha = 0.2) +
  geom_line(aes(x = time, y = net_rate),
            linewidth = 1, colour = "#504A4B") +
  geom_hline(yintercept = 0,
             linetype = "dashed", colour = "red") +
  labs(x = "Time (Ma)",
       y = "Rate (event/lineage/Myr)") +
  theme(axis.title.x = element_text(size = 22),
        axis.title.y = element_text(size = 22),
        axis.text = element_text(size = 18),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill = NA, linewidth = 0.5),
        plot.margin = margin(t=1, b=1, unit = "cm")) +
  coord_geo(dat = cnz_epochs, abbrv = TRUE, size = 5)

p <- ggarrange2(sp_ex, net_plot, nrow = 2, labels = c("Sp/Ex rates", "Net divers. rate"))
ggsave(plot = p,
       filename = "./figures/LTT_tropical/Tropical_RTTs.png",
       height = 300,
       width = 400,
       unit = "mm",
       dpi = 600)
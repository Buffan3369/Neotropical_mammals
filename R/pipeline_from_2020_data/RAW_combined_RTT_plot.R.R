################################################################################
################# Plotting RJMCMC output from RAW pbdb data ####################
################################################################################

library(scales)
library(palaeoverse)

## Full plot -------------------------------------------------------------------

pdf(file='./figures/RTT_plot_RAW_RJMCMC.pdf',width=10, height=15)
par(mfrow=c(3,2))

time=c(-0.888206475, -2.664619425,-4.441032375000001,-6.217445325,-7.993858275000001,-9.770271225,-11.546684175,-13.323097125,-15.099510075000001,-16.875923025000002,-18.652335975,-20.428748925,-22.205161875,-23.981574825,-25.757987775,-27.534400725,-29.310813675000002,-31.087226625000003,-32.86363957500001,-34.64005252500001,-36.416465475,-38.192878425,-39.969291375000005,-41.745704325000005,-43.52211727500001,-45.29853022500001,-47.07494317500001,-48.851356125,-50.627769075,-52.404182025000004,-54.180594975000005,-55.957007925000006,-57.73342087500001,-59.50983382500001,-61.28624677500001,-63.06265972500001,-64.839072675,-66.615485625,-68.391898575,-70.16831152500001,-71.944724475,-73.721137425,-75.497550375,-77.273963325,-79.050376275)
rate=c(0.6612425304793139, 0.2085174115164266,0.21036978600629874,0.08894190713517314,0.10202218195145513,0.3516468607740469,0.21217134705112028,0.1945816094383299,0.19328083329062104,0.1881814203125438,0.1976581067472219,0.20053211012153146,0.24073460231540833,0.07200159211387644,0.07169833770715921,0.07315143694375681,0.3351622502644145,0.0866654737007646,0.08422698289703148,0.08394058055557826,0.08312582097140866,0.08151078816155476,0.08049230773279081,0.08043912399280344,0.08044473909061034,0.08050034089743108,0.08158101324706951,0.08464093007431334,0.08473597604459429,0.0847638758721092,0.08478406936134086,0.36537308615335157,0.5058247073790795,0.4795323184612794,0.4737107900806251,0.4758439437282426,0.48801667112049685,0.49569086563278814,0.3391418538529479,0.23126149575447771,0.2194344619935198,0.21643475437095827,0.21564123769273058,0.21617453660406477,0.21900140203810378)
minHPD=c(0.5492561643751083, 0.13452857418118683,0.1348918676616598,0.021313171025963015,0.0537201404519833,0.2080581383327979,0.1574408504987824,0.14954665677034523,0.13770127538227533,0.06588350432038556,0.15547217041404196,0.15200201105828642,0.029176719908212807,0.03535485924780194,0.03557089067096802,0.032841000541381046,0.03667620177018752,0.05832814458883023,0.06009550958662211,0.06148946439807088,0.05953259416735376,0.03711930185432462,0.03965676747017368,0.03873533617133835,0.03873182875998802,0.03948858481399063,0.03444763810267403,0.06551124986300609,0.06607257135770293,0.0660486602805851,0.06602764472655445,0.0695620410713883,0.2791036373490658,0.21707015974328012,0.23086692578955698,0.2358318511166574,0.185621011303434,0.18228291222630041,0.0011742715682424177,0.0018596781538384542,0.002520323975322004,0.0024618450785772947,0.0016882750524427508,0.0017544006443908397,0.0020048440780807085)
maxHPD=c(0.7749154541473012, 0.25974794176059063,0.26457148879543596,0.1688982176777828,0.24157091295951202,0.5323146309646393,0.3701522594997544,0.2913853622085386,0.2936702935495259,0.2493384981160381,0.3016627455151933,0.3246304033576141,0.595879097899442,0.13104227084000802,0.13065451272467776,0.14019649388539987,0.6176484176475171,0.3250976074579456,0.14135768799568038,0.13658245848012757,0.13325208327111654,0.10563215710656923,0.10026721628516977,0.09916496120063009,0.09921308517944015,0.10028046446867257,0.10730649216615012,0.1497454705314239,0.1497454705314239,0.14983648298875646,0.15007941005182313,0.6022965799461859,1.53598494959634,0.7451115148282158,0.73676710502993,0.7311776084234101,1.070169005156595,1.7088281295553962,0.5825423746055916,0.485355853275834,0.4685049521661801,0.46369191814190097,0.46142329051011083,0.46142329051011083,0.46416203924821836)
plot(time,time,type = 'n', ylim = c(0, 1.879710942510936), xlim = c(-80.0,-0.0), ylab = 'Speciation rate', xlab = 'Time',main='Speciation (combined_10raw_input_mcmc)' )
polygon(c(time, rev(time)), c(maxHPD, rev(minHPD)), col = alpha('#4c4cec',0.3), border = NA)
lines(time,rate, col = '#4c4cec', lwd=2)
mids=c(-0.40404040404040403, -1.2121212121212122,-2.0202020202020203,-2.8282828282828283,-3.6363636363636367,-4.444444444444445,-5.252525252525253,-6.0606060606060606,-6.8686868686868685,-7.676767676767677,-8.484848484848484,-9.292929292929292,-10.1010101010101,-10.909090909090908,-11.717171717171716,-12.525252525252524,-13.333333333333332,-14.14141414141414,-14.949494949494948,-15.757575757575758,-16.565656565656564,-17.373737373737374,-18.18181818181818,-18.98989898989899,-19.797979797979796,-20.606060606060606,-21.41414141414141,-22.22222222222222,-23.030303030303028,-23.838383838383837,-24.646464646464644,-25.454545454545453,-26.262626262626263,-27.07070707070707,-27.87878787878788,-28.686868686868685,-29.494949494949495,-30.3030303030303,-31.11111111111111,-31.91919191919192,-32.72727272727273,-33.535353535353536,-34.343434343434346,-35.151515151515156,-35.95959595959596,-36.76767676767677,-37.57575757575758,-38.38383838383839,-39.1919191919192,-40.0,-40.80808080808081,-41.61616161616162,-42.42424242424243,-43.23232323232323,-44.04040404040404,-44.84848484848485,-45.65656565656566,-46.464646464646464,-47.27272727272727,-48.08080808080808,-48.88888888888889,-49.696969696969695,-50.505050505050505,-51.313131313131315,-52.121212121212125,-52.929292929292934,-53.73737373737374,-54.54545454545455,-55.35353535353536,-56.161616161616166,-56.96969696969697,-57.77777777777778,-58.58585858585859,-59.3939393939394,-60.2020202020202,-61.01010101010101,-61.81818181818182,-62.62626262626263,-63.43434343434343,-64.24242424242425,-65.05050505050505,-65.85858585858585,-66.66666666666667,-67.47474747474747,-68.28282828282829,-69.0909090909091,-69.8989898989899,-70.70707070707071,-71.51515151515152,-72.32323232323232,-73.13131313131314,-73.93939393939394,-74.74747474747475,-75.55555555555556,-76.36363636363636,-77.17171717171718,-77.97979797979798,-78.7878787878788,-79.5959595959596)
counts=c(0.0, 1.0,0.018698979591836733,0.0067857142857142855,0.24418367346938777,0.545280612244898,0.017423469387755103,0.010586734693877551,0.13813775510204082,0.5174234693877551,0.31630102040816327,0.044387755102040814,0.4247959183673469,0.19673469387755102,0.09630102040816327,0.002857142857142857,0.004566326530612245,0.09165816326530613,0.022474489795918366,0.0065051020408163265,0.03683673469387755,0.10586734693877552,0.002704081632653061,0.02239795918367347,0.432015306122449,0.12482142857142857,0.7964540816326531,0.18331632653061225,0.009489795918367346,0.009770408163265305,0.0020153061224489795,0.011326530612244898,0.01971938775510204,0.09869897959183674,0.4964540816326531,0.21255102040816326,0.5911224489795919,0.15645408163265306,0.02431122448979592,0.012423469387755102,0.0066581632653061225,0.009311224489795919,0.012831632653061224,0.02086734693877551,0.04997448979591837,0.014540816326530611,0.02875,0.01767857142857143,0.0030357142857142857,0.0009948979591836735,0.0003826530612244898,0.0003061224489795918,0.000586734693877551,0.000586734693877551,0.002066326530612245,0.014693877551020407,0.028520408163265305,0.0924234693877551,0.03711734693877551,0.005918367346938775,0.0016836734693877551,0.0004846938775510204,0.0006377551020408163,0.0007908163265306123,0.0005102040816326531,0.0007397959183673469,0.12191326530612245,0.4392091836734694,0.21045918367346939,0.22653061224489796,0.0071938775510204086,0.07630102040816326,0.023418367346938775,0.011020408163265306,0.004209183673469388,0.004974489795918367,0.01086734693877551,0.012270408163265306,0.05076530612244898,0.01385204081632653,0.027806122448979592,0.05785714285714286,0.28380102040816324,0.13568877551020408,0.07025510204081632,0.03645408163265306,0.019107142857142857,0.009387755102040816,0.0066326530612244895,0.003954081632653061,0.0028316326530612246,0.0024489795918367346,0.002857142857142857,0.002270408163265306,0.002142857142857143,0.0032142857142857142,0.005178571428571428,0.010229591836734693,0.03354591836734694)
plot(mids,counts,type = 'h', xlim = c(-80.0,-0.0), ylim=c(0,1.0), ylab = 'Frequency of rate shift', xlab = 'Time',lwd=5,col='#4c4cec')
bf2 = 0.03339241736377766
bf6 = 0.20335373382642297
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)

time=c(-0.888206475, -2.664619425,-4.441032375000001,-6.217445325,-7.993858275000001,-9.770271225,-11.546684175,-13.323097125,-15.099510075000001,-16.875923025000002,-18.652335975,-20.428748925,-22.205161875,-23.981574825,-25.757987775,-27.534400725,-29.310813675000002,-31.087226625000003,-32.86363957500001,-34.64005252500001,-36.416465475,-38.192878425,-39.969291375000005,-41.745704325000005,-43.52211727500001,-45.29853022500001,-47.07494317500001,-48.851356125,-50.627769075,-52.404182025000004,-54.180594975000005,-55.957007925000006,-57.73342087500001,-59.50983382500001,-61.28624677500001,-63.06265972500001,-64.839072675,-66.615485625,-68.391898575,-70.16831152500001,-71.944724475,-73.721137425,-75.497550375,-77.273963325,-79.050376275)
rate=c(0.4891661382905625, 0.029623017979541803,0.1716183532910515,0.15898191797471095,0.1625316721609473,0.16089575410229218,0.16086700026883657,0.1620843545769384,0.16202163349337656,0.17497818556125616,0.15457214477146874,0.15360471228561084,0.1575502883056704,0.15216003760327182,0.11556704902105203,0.11467543215524767,0.12289145097948709,0.12327495315704085,0.12351568073498245,0.12385673199974447,0.1240820977443364,0.13410455945611133,0.06872267530134187,0.05597344106427739,0.055414896331817246,0.05528501512306315,0.055258917185944174,0.055255245833114086,0.05525577799246777,0.055254329093602145,0.05524905273050254,0.055243615228178916,0.055361918965189716,0.05603888686658368,0.05906988285279566,0.5263099354259716,0.49267363436626743,0.47923823379857633,0.35663988351079784,0.23666526633289003,0.16965783411195495,0.1614678408358281,0.14881769529982583,0.14522776344697091,0.1446499792159251)
minHPD=c(0.39900223368809556, 0.0025677697974018994,0.017655000192180557,0.06748769653663617,0.13119074578612858,0.1350394718308159,0.13500349495034342,0.1349822483075606,0.13398000806265603,0.13843379302623995,0.10232575366295045,0.10235311652466043,0.09962512389967927,0.06289540735597635,0.020854381982498196,0.02251288202829276,0.0770546980766294,0.0772184316627898,0.07885070379590411,0.07885070379590411,0.07873267545030468,0.07531170211836506,0.04304104646721486,0.03893278271329998,0.040107562335147506,0.04155127640282951,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.041767742301710375,0.04091165729838636,0.036326708682377064,0.03760322862882369,0.18558213859536551,0.1711357531700986,0.1374452611048519,0.05626376241164021,0.03286326770973362,4.343334017688392e-05,0.0001256098209922307,0.0001256098209922307,4.343334017688392e-05,4.343334017688392e-05)
maxHPD=c(0.5820373943629622, 0.06799857906813828,0.4874494878994833,0.18908926634544412,0.19927346919679567,0.19129928833332016,0.19134737339976896,0.19143657647897083,0.19143657647897083,0.46962407517234134,0.19131972620646984,0.19116643364302857,0.2753676369215085,0.21745427495251413,0.16168541612381726,0.1592285112729465,0.1609341293102426,0.15934727939284696,0.16074163879817285,0.16131683625562196,0.16206902096191403,0.3839272472231209,0.15361911924346416,0.10914313662275217,0.07122287436606933,0.07020669755992467,0.07020114315866757,0.07015932671141951,0.07016689519489921,0.07017012857697363,0.07020114315866757,0.07020669755992467,0.07072414251395952,0.2463334367103292,0.5071599716395476,0.9895418695261538,0.893183645816358,0.8864882076168143,0.794477504437094,0.6582356771140654,0.42727568557842255,0.397259850524059,0.3598180753310035,0.35002736036700755,0.34874605499155903)
plot(time,time,type = 'n', ylim = c(0, 1.0884960564787691), xlim = c(-80.0,-0.0), ylab = 'Extinction rate', xlab = 'Time',main='Extinction' )
polygon(c(time, rev(time)), c(maxHPD, rev(minHPD)), col = alpha('#e34a33',0.3), border = NA)
lines(time,rate, col = '#e34a33', lwd=2)
mids=c(-0.40404040404040403, -1.2121212121212122,-2.0202020202020203,-2.8282828282828283,-3.6363636363636367,-4.444444444444445,-5.252525252525253,-6.0606060606060606,-6.8686868686868685,-7.676767676767677,-8.484848484848484,-9.292929292929292,-10.1010101010101,-10.909090909090908,-11.717171717171716,-12.525252525252524,-13.333333333333332,-14.14141414141414,-14.949494949494948,-15.757575757575758,-16.565656565656564,-17.373737373737374,-18.18181818181818,-18.98989898989899,-19.797979797979796,-20.606060606060606,-21.41414141414141,-22.22222222222222,-23.030303030303028,-23.838383838383837,-24.646464646464644,-25.454545454545453,-26.262626262626263,-27.07070707070707,-27.87878787878788,-28.686868686868685,-29.494949494949495,-30.3030303030303,-31.11111111111111,-31.91919191919192,-32.72727272727273,-33.535353535353536,-34.343434343434346,-35.151515151515156,-35.95959595959596,-36.76767676767677,-37.57575757575758,-38.38383838383839,-39.1919191919192,-40.0,-40.80808080808081,-41.61616161616162,-42.42424242424243,-43.23232323232323,-44.04040404040404,-44.84848484848485,-45.65656565656566,-46.464646464646464,-47.27272727272727,-48.08080808080808,-48.88888888888889,-49.696969696969695,-50.505050505050505,-51.313131313131315,-52.121212121212125,-52.929292929292934,-53.73737373737374,-54.54545454545455,-55.35353535353536,-56.161616161616166,-56.96969696969697,-57.77777777777778,-58.58585858585859,-59.3939393939394,-60.2020202020202,-61.01010101010101,-61.81818181818182,-62.62626262626263,-63.43434343434343,-64.24242424242425,-65.05050505050505,-65.85858585858585,-66.66666666666667,-67.47474747474747,-68.28282828282829,-69.0909090909091,-69.8989898989899,-70.70707070707071,-71.51515151515152,-72.32323232323232,-73.13131313131314,-73.93939393939394,-74.74747474747475,-75.55555555555556,-76.36363636363636,-77.17171717171718,-77.97979797979798,-78.7878787878788,-79.5959595959596)
counts=c(0.0, 1.0,0.8081632653061225,0.2430357142857143,0.9488010204081633,0.027678571428571427,0.12691326530612246,0.057346938775510205,0.009260204081632653,0.023316326530612243,0.022831632653061224,0.0024489795918367346,0.0011224489795918367,0.00510204081632653,0.02959183673469388,0.0014540816326530613,0.0013775510204081633,0.0016071428571428571,0.14002551020408163,0.19760204081632654,0.32510204081632654,0.05502551020408163,0.007448979591836735,0.005025510204081633,0.002704081632653061,0.0623469387755102,0.007066326530612245,0.02528061224489796,0.16823979591836735,0.24334183673469387,0.07760204081632653,0.008239795918367347,0.007066326530612245,0.05803571428571429,0.10224489795918368,0.013596938775510204,0.0028061224489795917,0.0023214285714285715,0.003010204081632653,0.003061224489795918,0.0038010204081632653,0.00413265306122449,0.0025255102040816326,0.0027551020408163266,0.010127551020408163,0.15002551020408164,0.05755102040816327,0.35459183673469385,0.35066326530612246,0.16857142857142857,0.043673469387755105,0.034744897959183674,0.014566326530612244,0.0069642857142857145,0.002729591836734694,0.0008928571428571428,0.0005357142857142857,0.0003826530612244898,0.0002806122448979592,5.102040816326531e-05,0.00017857142857142857,0.00022959183673469387,0.0001530612244897959,0.00020408163265306123,0.00020408163265306123,0.00025510204081632655,0.0004336734693877551,0.00017857142857142857,0.0003826530612244898,0.0029081632653061226,0.012933673469387756,0.03844387755102041,0.025459183673469388,0.07961734693877551,0.18767857142857142,0.5054081632653061,0.154515306122449,0.041607142857142856,0.019311224489795917,0.014489795918367347,0.01941326530612245,0.04306122448979592,0.09982142857142857,0.12875,0.11727040816326531,0.07530612244897959,0.10704081632653062,0.03841836734693878,0.016377551020408162,0.012551020408163265,0.024770408163265305,0.023596938775510203,0.010408163265306122,0.0075,0.00413265306122449,0.0023214285714285715,0.0018112244897959184,0.0008673469387755102,0.0016326530612244899)
plot(mids,counts,type = 'h', xlim = c(-80.0,-0.0), ylim=c(0,1.0), ylab = 'Frequency of rate shift', xlab = 'Time',lwd=5,col='#e34a33')
abline(h=bf2, lty=2)
abline(h=bf6, lty=2)
#Net Diversification Rate
time=c(-0.888206475, -2.664619425,-4.441032375000001,-6.217445325,-7.993858275000001,-9.770271225,-11.546684175,-13.323097125,-15.099510075000001,-16.875923025000002,-18.652335975,-20.428748925,-22.205161875,-23.981574825,-25.757987775,-27.534400725,-29.310813675000002,-31.087226625000003,-32.86363957500001,-34.64005252500001,-36.416465475,-38.192878425,-39.969291375000005,-41.745704325000005,-43.52211727500001,-45.29853022500001,-47.07494317500001,-48.851356125,-50.627769075,-52.404182025000004,-54.180594975000005,-55.957007925000006,-57.73342087500001,-59.50983382500001,-61.28624677500001,-63.06265972500001,-64.839072675,-66.615485625,-68.391898575,-70.16831152500001,-71.944724475,-73.721137425,-75.497550375,-77.273963325,-79.050376275)
net_rate=c(0.17219083845381297, 0.17018012038382965,-0.04975990940752092,-0.058610992797581085,-0.04611992011826673,0.18913355020617847,0.07579968022490523,0.038152224624745726,0.0351005780328687,-0.06443060272999693,0.06156050665000588,0.0700430795870444,0.11408237664687645,-0.07676501957406062,-0.030170265849892984,-0.024306431648521473,0.19285724806877352,-0.0031821608718312563,-0.03148213002430352,-0.03357609050672349,-0.037171889153364064,-0.086996739786748,-0.012697001629641833,0.017233577891000856,0.020768562866964362,0.021509966060423418,0.024948074090868896,0.036385268871827275,0.036551175540609715,0.036627733407806284,0.03671489725520845,0.25698298274054476,0.5400111118390132,0.4144212823481257,0.3289690433091594,-0.07510848262965558,0.04550598573769471,0.11803767504109207,-0.08534384885592335,-0.028694726224778255,0.0425010169878903,0.05082725503861234,0.06681955202469878,0.07214439886931742,0.07530864107361707)
net_minHPD=c(0.028141657995555347, 0.09687896961670925,-0.28878361010795894,-0.15780211958093782,-0.1294706859571153,0.03544003396850684,-0.011879295778321697,-0.03189444465814781,-0.05067457909414119,-0.2842790886710336,-0.011490610669290052,-0.015319428019787334,-0.1406298741996334,-0.1941588846388242,-0.09823856381692793,-0.09181504598453602,-0.07661633079731581,-0.09611147108948319,-0.09043742918360237,-0.08693394328415287,-0.08796799296451444,-0.30020136526024593,-0.08564923331370822,-0.031734628874136375,-0.019781847264707945,-0.01804442173635319,-0.024193467498736687,0.004542094042958966,0.0047169891060012265,0.004733279907855881,0.004733279907855881,0.008743016250175567,0.22060528454245115,0.054924195334201564,-0.1437411262280602,-0.5647314997426679,-0.4863027377780127,-0.4837711635824843,-0.7247235891198271,-0.6477633051246605,-0.17631608589830872,-0.14604030307725988,-0.12753179077065663,-0.12130073493582952,-0.111251018619466)
net_maxHPD=c(0.3195336290154928, 0.23893500677440652,0.1921697788265897,0.02966481430332729,0.0920872367594967,0.37453567252800235,0.22494589841729368,0.12595751389015755,0.12451199441428815,0.08891664941970817,0.14493323713827952,0.17575120864249222,0.45554387086135195,0.027071098802796574,0.048092269102646905,0.05560323792360096,0.4841042391680651,0.20153996895862936,0.026380412731010702,0.02348888437577601,0.01977280634916051,0.02304745892716016,0.04442407257238481,0.04908424229803924,0.04547862208182922,0.04618129239117301,0.05338515630439003,0.09343343176352663,0.09309566469572236,0.09319960979780709,0.09338640668240503,0.5491690610937564,1.5196654482643945,0.7163336374149692,0.6972533366146583,0.31884985567553303,0.49974618806488214,1.0203922157382341,0.37871430301310555,0.3057371165024301,0.30874262008945286,0.29918841474098073,0.3112179573211027,0.3208761575222059,0.33219513688317803)
plot(time,time,type = 'n', ylim = c(-0.7971959480318099, 1.671631993090834), xlim = c(-80.0,-0.0), ylab = 'Net Rate', xlab = 'Time',lwd=2, main='Net diversification', col= '#504A4B' )
polygon(c(time, rev(time)), c(net_maxHPD, rev(net_minHPD)), col = alpha('#504A4B',0.3), border = NA)
lines(time,net_rate, col = '#504A4B', lwd=2)
abline(h=0,lty=2)


time=c(-0.888206475, -2.664619425,-4.441032375000001,-6.217445325,-7.993858275000001,-9.770271225,-11.546684175,-13.323097125,-15.099510075000001,-16.875923025000002,-18.652335975,-20.428748925,-22.205161875,-23.981574825,-25.757987775,-27.534400725,-29.310813675000002,-31.087226625000003,-32.86363957500001,-34.64005252500001,-36.416465475,-38.192878425,-39.969291375000005,-41.745704325000005,-43.52211727500001,-45.29853022500001,-47.07494317500001,-48.851356125,-50.627769075,-52.404182025000004,-54.180594975000005,-55.957007925000006,-57.73342087500001,-59.50983382500001,-61.28624677500001,-63.06265972500001,-64.839072675,-66.615485625,-68.391898575,-70.16831152500001,-71.944724475,-73.721137425,-75.497550375,-77.273963325,-79.050376275)
rate=c(2.038105454904968, 30.69426115585583,3.8908094364620696,6.561027055602715,5.960973587427844,6.28068922404275,6.2901653895128655,6.101065032264692,6.113806296734559,4.055275392062104,6.751031163690435,6.783494471915679,6.223509655708376,6.501532681150944,9.43847972626664,9.575441893813386,8.23640362028047,8.185485205404369,8.156342400167066,8.113021302516982,8.085491863281714,5.955560856272591,11.09564060030037,16.655732370941593,17.695524586046087,17.89661144903111,17.920241775594608,17.92340603114168,17.923684665935976,17.925293972178252,17.928388729088958,17.931996119452332,17.39043788722806,13.913400894053703,6.840779350977389,1.796963700242453,1.97649187450456,1.9663057097925762,2.517504916944637,3.5741527868573457,5.03720260710411,5.333889945207751,5.868106845787058,6.04577474914641,6.073821699566554)
minHPD=c(2.038105454904968, 30.69426115585583,3.8908094364620696,6.561027055602715,5.960973587427844,6.28068922404275,6.2901653895128655,6.101065032264692,6.113806296734559,4.055275392062104,6.751031163690435,6.783494471915679,6.223509655708376,6.501532681150944,9.43847972626664,9.575441893813386,8.23640362028047,8.185485205404369,8.156342400167066,8.113021302516982,8.085491863281714,5.955560856272591,11.09564060030037,16.655732370941593,17.695524586046087,17.89661144903111,17.920241775594608,17.92340603114168,17.923684665935976,17.925293972178252,17.928388729088958,17.931996119452332,17.39043788722806,13.913400894053703,6.840779350977389,1.796963700242453,1.97649187450456,1.9663057097925762,2.517504916944637,3.5741527868573457,5.03720260710411,5.333889945207751,5.868106845787058,6.04577474914641,6.073821699566554)
maxHPD=c(2.038105454904968, 30.69426115585583,3.8908094364620696,6.561027055602715,5.960973587427844,6.28068922404275,6.2901653895128655,6.101065032264692,6.113806296734559,4.055275392062104,6.751031163690435,6.783494471915679,6.223509655708376,6.501532681150944,9.43847972626664,9.575441893813386,8.23640362028047,8.185485205404369,8.156342400167066,8.113021302516982,8.085491863281714,5.955560856272591,11.09564060030037,16.655732370941593,17.695524586046087,17.89661144903111,17.920241775594608,17.92340603114168,17.923684665935976,17.925293972178252,17.928388729088958,17.931996119452332,17.39043788722806,13.913400894053703,6.840779350977389,1.796963700242453,1.97649187450456,1.9663057097925762,2.517504916944637,3.5741527868573457,5.03720260710411,5.333889945207751,5.868106845787058,6.04577474914641,6.073821699566554)
plot(time,time,type = 'n', ylim = c(0, 33.76368727144142), xlim = c(-80.0,-0.0), ylab = 'Mean longevity', xlab = 'Time',main='Longevity' )
polygon(c(time, rev(time)), c(maxHPD, rev(minHPD)), col = alpha('#756bb1',0.3), border = NA)
lines(time,rate, col = '#756bb1', lwd=4)

n <- dev.off()

## Rates only ------------------------------------------------------------------

plot_RTT <- function(age,hpd_M,hpd_m,mean_m,color){
  N=100
  beta=(1:(N-1))/N
  alpha_shape=0.25
  cat=1-(beta^(1./alpha_shape))
  for (i in 1:(N-1)){
    trans= 1/N + 2/N
    polygon(c(age, rev(age)), c(hpd_M-((hpd_M-mean_m)*cat[i]), rev(hpd_m+((mean_m-hpd_m)*cat[i]))), col = alpha(color,trans), border = NA)
  }
  lines(rev(age), rev(mean_m), col = color, lwd=3)
}

add_geochrono <- function(Y1,Y2){	
  polygon(-c(100.5,100.5,66,66),       c(Y1,Y2,Y2,Y1), col = "#BAD25F", lwd = 0.5) # Upper Cretaceous
  polygon(-c(66,66,56,56),             c(Y1,Y2,Y2,Y1), col = "#F8B77D", lwd = 0.5) # Paleocene
  polygon(-c(56,56,33.9,33.9),         c(Y1,Y2,Y2,Y1), col = "#FAC18A", lwd = 0.5) # Eocene
  polygon(-c(33.9,33.9,23.03,23.03),   c(Y1,Y2,Y2,Y1), col = "#FBCC98", lwd = 0.5) # Oligocene
  polygon(-c(23.03,23.03,5.33,5.33),   c(Y1,Y2,Y2,Y1), col = "#FFED00", lwd = 0.5) # Miocene
  polygon(-c(5.33,5.33,2.58,2.58),     c(Y1,Y2,Y2,Y1), col = "#FFF7B2", lwd = 0.5) # Pliocene
  polygon(-c(2.58,2.58,0.0117,0.0117), c(Y1,Y2,Y2,Y1), col = "#FFF1C4", lwd = 0.5) # Pleistocene
  polygon(-c(0.0117,0.0117,0,0),       c(Y1,Y2,Y2,Y1), col = "#FEF6F2", lwd = 0.5) # Holocene
}


trans=0.5
age=(0:(80-1))* -1
#speciation params
sp_rate=c(0.6612425304793139, 0.2085174115164266,0.21036978600629874,0.08894190713517314,0.10202218195145513,0.3516468607740469,0.21217134705112028,0.1945816094383299,0.19328083329062104,0.1881814203125438,0.1976581067472219,0.20053211012153146,0.24073460231540833,0.07200159211387644,0.07169833770715921,0.07315143694375681,0.3351622502644145,0.0866654737007646,0.08422698289703148,0.08394058055557826,0.08312582097140866,0.08151078816155476,0.08049230773279081,0.08043912399280344,0.08044473909061034,0.08050034089743108,0.08158101324706951,0.08464093007431334,0.08473597604459429,0.0847638758721092,0.08478406936134086,0.36537308615335157,0.5058247073790795,0.4795323184612794,0.4737107900806251,0.4758439437282426,0.48801667112049685,0.49569086563278814,0.3391418538529479,0.23126149575447771,0.2194344619935198,0.21643475437095827,0.21564123769273058,0.21617453660406477,0.21900140203810378)
sp_minHPD=c(0.5492561643751083, 0.13452857418118683,0.1348918676616598,0.021313171025963015,0.0537201404519833,0.2080581383327979,0.1574408504987824,0.14954665677034523,0.13770127538227533,0.06588350432038556,0.15547217041404196,0.15200201105828642,0.029176719908212807,0.03535485924780194,0.03557089067096802,0.032841000541381046,0.03667620177018752,0.05832814458883023,0.06009550958662211,0.06148946439807088,0.05953259416735376,0.03711930185432462,0.03965676747017368,0.03873533617133835,0.03873182875998802,0.03948858481399063,0.03444763810267403,0.06551124986300609,0.06607257135770293,0.0660486602805851,0.06602764472655445,0.0695620410713883,0.2791036373490658,0.21707015974328012,0.23086692578955698,0.2358318511166574,0.185621011303434,0.18228291222630041,0.0011742715682424177,0.0018596781538384542,0.002520323975322004,0.0024618450785772947,0.0016882750524427508,0.0017544006443908397,0.0020048440780807085)
sp_maxHPD=c(0.7749154541473012, 0.25974794176059063,0.26457148879543596,0.1688982176777828,0.24157091295951202,0.5323146309646393,0.3701522594997544,0.2913853622085386,0.2936702935495259,0.2493384981160381,0.3016627455151933,0.3246304033576141,0.595879097899442,0.13104227084000802,0.13065451272467776,0.14019649388539987,0.6176484176475171,0.3250976074579456,0.14135768799568038,0.13658245848012757,0.13325208327111654,0.10563215710656923,0.10026721628516977,0.09916496120063009,0.09921308517944015,0.10028046446867257,0.10730649216615012,0.1497454705314239,0.1497454705314239,0.14983648298875646,0.15007941005182313,0.6022965799461859,1.53598494959634,0.7451115148282158,0.73676710502993,0.7311776084234101,1.070169005156595,1.7088281295553962,0.5825423746055916,0.485355853275834,0.4685049521661801,0.46369191814190097,0.46142329051011083,0.46142329051011083,0.46416203924821836)
sp_col = "#4c4cec"
#extinction params
ex_rate=c(0.4891661382905625, 0.029623017979541803,0.1716183532910515,0.15898191797471095,0.1625316721609473,0.16089575410229218,0.16086700026883657,0.1620843545769384,0.16202163349337656,0.17497818556125616,0.15457214477146874,0.15360471228561084,0.1575502883056704,0.15216003760327182,0.11556704902105203,0.11467543215524767,0.12289145097948709,0.12327495315704085,0.12351568073498245,0.12385673199974447,0.1240820977443364,0.13410455945611133,0.06872267530134187,0.05597344106427739,0.055414896331817246,0.05528501512306315,0.055258917185944174,0.055255245833114086,0.05525577799246777,0.055254329093602145,0.05524905273050254,0.055243615228178916,0.055361918965189716,0.05603888686658368,0.05906988285279566,0.5263099354259716,0.49267363436626743,0.47923823379857633,0.35663988351079784,0.23666526633289003,0.16965783411195495,0.1614678408358281,0.14881769529982583,0.14522776344697091,0.1446499792159251)
ex_minHPD=c(0.39900223368809556, 0.0025677697974018994,0.017655000192180557,0.06748769653663617,0.13119074578612858,0.1350394718308159,0.13500349495034342,0.1349822483075606,0.13398000806265603,0.13843379302623995,0.10232575366295045,0.10235311652466043,0.09962512389967927,0.06289540735597635,0.020854381982498196,0.02251288202829276,0.0770546980766294,0.0772184316627898,0.07885070379590411,0.07885070379590411,0.07873267545030468,0.07531170211836506,0.04304104646721486,0.03893278271329998,0.040107562335147506,0.04155127640282951,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.04181402901616897,0.041767742301710375,0.04091165729838636,0.036326708682377064,0.03760322862882369,0.18558213859536551,0.1711357531700986,0.1374452611048519,0.05626376241164021,0.03286326770973362,4.343334017688392e-05,0.0001256098209922307,0.0001256098209922307,4.343334017688392e-05,4.343334017688392e-05)
ex_maxHPD=c(0.5820373943629622, 0.06799857906813828,0.4874494878994833,0.18908926634544412,0.19927346919679567,0.19129928833332016,0.19134737339976896,0.19143657647897083,0.19143657647897083,0.46962407517234134,0.19131972620646984,0.19116643364302857,0.2753676369215085,0.21745427495251413,0.16168541612381726,0.1592285112729465,0.1609341293102426,0.15934727939284696,0.16074163879817285,0.16131683625562196,0.16206902096191403,0.3839272472231209,0.15361911924346416,0.10914313662275217,0.07122287436606933,0.07020669755992467,0.07020114315866757,0.07015932671141951,0.07016689519489921,0.07017012857697363,0.07020114315866757,0.07020669755992467,0.07072414251395952,0.2463334367103292,0.5071599716395476,0.9895418695261538,0.893183645816358,0.8864882076168143,0.794477504437094,0.6582356771140654,0.42727568557842255,0.397259850524059,0.3598180753310035,0.35002736036700755,0.34874605499155903)
ex_col = "#e34a33"
#net diversification params
net_rate=c(0.17219083845381297, 0.17018012038382965,-0.04975990940752092,-0.058610992797581085,-0.04611992011826673,0.18913355020617847,0.07579968022490523,0.038152224624745726,0.0351005780328687,-0.06443060272999693,0.06156050665000588,0.0700430795870444,0.11408237664687645,-0.07676501957406062,-0.030170265849892984,-0.024306431648521473,0.19285724806877352,-0.0031821608718312563,-0.03148213002430352,-0.03357609050672349,-0.037171889153364064,-0.086996739786748,-0.012697001629641833,0.017233577891000856,0.020768562866964362,0.021509966060423418,0.024948074090868896,0.036385268871827275,0.036551175540609715,0.036627733407806284,0.03671489725520845,0.25698298274054476,0.5400111118390132,0.4144212823481257,0.3289690433091594,-0.07510848262965558,0.04550598573769471,0.11803767504109207,-0.08534384885592335,-0.028694726224778255,0.0425010169878903,0.05082725503861234,0.06681955202469878,0.07214439886931742,0.07530864107361707)
net_minHPD=c(0.028141657995555347, 0.09687896961670925,-0.28878361010795894,-0.15780211958093782,-0.1294706859571153,0.03544003396850684,-0.011879295778321697,-0.03189444465814781,-0.05067457909414119,-0.2842790886710336,-0.011490610669290052,-0.015319428019787334,-0.1406298741996334,-0.1941588846388242,-0.09823856381692793,-0.09181504598453602,-0.07661633079731581,-0.09611147108948319,-0.09043742918360237,-0.08693394328415287,-0.08796799296451444,-0.30020136526024593,-0.08564923331370822,-0.031734628874136375,-0.019781847264707945,-0.01804442173635319,-0.024193467498736687,0.004542094042958966,0.0047169891060012265,0.004733279907855881,0.004733279907855881,0.008743016250175567,0.22060528454245115,0.054924195334201564,-0.1437411262280602,-0.5647314997426679,-0.4863027377780127,-0.4837711635824843,-0.7247235891198271,-0.6477633051246605,-0.17631608589830872,-0.14604030307725988,-0.12753179077065663,-0.12130073493582952,-0.111251018619466)
net_maxHPD=c(0.3195336290154928, 0.23893500677440652,0.1921697788265897,0.02966481430332729,0.0920872367594967,0.37453567252800235,0.22494589841729368,0.12595751389015755,0.12451199441428815,0.08891664941970817,0.14493323713827952,0.17575120864249222,0.45554387086135195,0.027071098802796574,0.048092269102646905,0.05560323792360096,0.4841042391680651,0.20153996895862936,0.026380412731010702,0.02348888437577601,0.01977280634916051,0.02304745892716016,0.04442407257238481,0.04908424229803924,0.04547862208182922,0.04618129239117301,0.05338515630439003,0.09343343176352663,0.09309566469572236,0.09319960979780709,0.09338640668240503,0.5491690610937564,1.5196654482643945,0.7163336374149692,0.6972533366146583,0.31884985567553303,0.49974618806488214,1.0203922157382341,0.37871430301310555,0.3057371165024301,0.30874262008945286,0.29918841474098073,0.3112179573211027,0.3208761575222059,0.33219513688317803)
net_col="#504A4B"

par(mfrow=c(2,1))
#Combined speciation and extinction plot
plot(c(seq(-155,0,by=1),0),rep(2,length(c(seq(155,0,by=-1),0))), xlab="", ylab="Rates (events/Myr/lineage)", xlim=c(-80,0), ylim=c(0,1), type="l", col="white",lwd="1",las="1",cex.axis="1",cex.main="1",cex.lab="1",bty="n", main="", axes=F)
rect(-85,-0.52,-66,300, col="whitesmoke", border=NA)
rect(-66,-0.52,-56,300, col="white", border=NA)
rect(-56,-0.52,-33.9,300, col="whitesmoke", border=NA)
rect(-33.9,-0.52,-23.03,300, col="white", border=NA)
rect(-23.03,-0.52,-5.33,300, col="whitesmoke", border=NA)
rect(-5.33,-0.52,-2.58,300, col="white", border=NA)
rect(-2.58,-0.52,0,300, col="whitesmoke", border=NA)
abline(v=c(-2.58,-5.33,-23.03,-33.9,-56, -66), lty="dashed")

lines(age,age,type = 'n')
plot_RTT(age = time, hpd_m = sp_minHPD, hpd_M = sp_maxHPD, mean_m = sp_rate, color = sp_col)
lines(age,age,type = 'n')
plot_RTT(age = time, hpd_m = ex_minHPD, hpd_M = ex_maxHPD, mean_m = ex_rate, color = ex_col)

axis(side=1, seq(-90, 0, by=10), col="black",col.axis="black",las=1)
axis(side=2, seq(0, 1, by=0.1), col="black",col.axis="black",las=2)

add_geochrono(0, -0.1)

#legend("topright", bty="n", c("Speciation rate","Extinction rate"),lwd="4",col=c("#4c4cec","#e34a33"), cex=1)

#Net diversification
plot(c(seq(-155,0,by=1),0),rep(2,length(c(seq(155,0,by=-1),0))), xlab="", ylab="Rates (events/Myr/lineage)", xlim=c(-80,0), ylim=c(-0.5,0.7), type="l", col="white",lwd="1",las="1",cex.axis="1",cex.main="1",cex.lab="1",bty="n", main="", axes=F)
rect(-85,-0.52,-66,300, col="whitesmoke", border=NA)
rect(-66,-0.52,-56,300, col="white", border=NA)
rect(-56,-0.52,-33.9,300, col="whitesmoke", border=NA)
rect(-33.9,-0.52,-23.03,300, col="white", border=NA)
rect(-23.03,-0.52,-5.33,300, col="whitesmoke", border=NA)
rect(-5.33,-0.52,-2.58,300, col="white", border=NA)
rect(-2.58,-0.52,0,300, col="whitesmoke", border=NA)
abline(v=c(-2.58,-5.33,-23.03,-33.9,-56, -66), lty="dashed")

lines(age,age,type = 'n')
abline(h=0,lty=2,col="darkred")
plot_RTT(age = time, hpd_m = net_minHPD, hpd_M = net_maxHPD, mean_m = net_rate, color = net_col)
lines(rev(time), rev(net_rate), col = "black", lwd=3)

axis(side=1, seq(-90, 0, by=10), col="black",col.axis="black",las=1)
axis(side=2, seq(-0.5, 0.7, by=0.1), col="black",col.axis="black",las=2)
add_geochrono(-0.5, -0.6)

#legend(bty="n", c("Net diversification rate"),lwd="4",col=c("#504A4B"), cex=1)

dev.print(pdf, file="./figures/RTT_plot_raw_RatesOnly.pdf", width=7.5, height=9)

